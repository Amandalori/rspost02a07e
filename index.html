<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Restaurant POS System</title> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"> 
  <link rel="apple-touch-icon" href="/rspost02a07e/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="rspost02a07" href="/rspost02a07e/icons/icon-512x512.png">
    <link rel="manifest" href="/rspost02a07e/manifest.json">
    <link rel="manifest" href="/rspost02a07e/sw.js">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- WebRTC Library (PeerJS) --> 
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script> 
 <style type="text/css" id="dcoder_stylesheet">/* Global Styles - modern ui7 Color Scheme */
:root {
  /* Light Mode Colors from modern ui7 */
  --primary-color-light: #ff8839;
  --secondary-color-light: #ff9e5e;
  --accent-color-light: #eb843f;
  --danger-color-light: #dc3545;
  --success-color-light: #28a745;
  --text-color-light: #333333;
  --text-emphasis-light: #1a1a1a;
  --bg-color-light: #f8f9fa;
  --card-bg-light:  rgba(255, 255, 255, 0.7);
  --border-color-light: rgba(224, 224, 224, 0.5);
  --shadow-color-light: rgba(0, 0, 0, 0.1);
  --glass-bg-light: rgba(255, 255, 255, 0.7);
  --glass-border-light: rgba(224, 224, 224, 0.5);

  /* Dark Mode Colors from modern ui7 */
  --primary-color-dark: #ff8839;
  --secondary-color-dark: #ff9e5e;
  --accent-color-dark: #eb843f;
  --danger-color-dark: #ff4444;
  --success-color-dark: #28a745;
  --text-color-dark: #b0b0b0;
  --text-emphasis-dark: #ffffff;
  --bg-color-dark: #1a1a1a;
  --card-bg-dark: rgba(42, 42, 42, 0.7);
  --border-color-dark: rgba(58, 58, 58, 0.5);
  --shadow-color-dark: rgba(0, 0, 0, 0.3);
  --glass-bg-dark: rgba(42, 42, 42, 0.7);
  --glass-border-dark: rgba(58, 58, 58, 0.5);

  /* General Variables */
  --warning-color: #ffc107;
  --border-radius: 12px;
  --transition-duration: 0.4s ease-in-out;
  --sidebar-width: 220px;
  --header-height: 56px;
}

/* Default to Dark Mode */
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
  background: var(--bg-color);
  color: var(--text-color);
  transition: background var(--transition-duration), color var(--transition-duration);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  position: relative;
}

/* Dark Mode */
body.dark-mode {
  --primary-color: var(--primary-color-dark);
  --secondary-color: var(--secondary-color-dark);
  --accent-color: var(--accent-color-dark);
  --success-color: var(--success-color-dark);
  --danger-color: var(--danger-color-dark);
  --text-color: var(--text-color-dark);
  --text-emphasis: var(--text-emphasis-dark);
  --bg-color: var(--bg-color-dark);
  --card-bg: var(--card-bg-dark);
  --border-color: var(--border-color-dark);
  --shadow-color: var(--shadow-color-dark);
  --glass-bg: var(--glass-bg-dark);
  --glass-border: var(--glass-border-dark);
}

/* Light Mode */
body.light-mode {
  --primary-color: var(--primary-color-light);
  --secondary-color: var(--secondary-color-light);
  --accent-color: var(--accent-color-light);
  --danger-color: var(--danger-color-light);
  --success-color: var(--success-color-light);
  --text-color: var(--text-color-light);
  --text-emphasis: var(--text-emphasis-light);
  --bg-color: var(--bg-color-light);
  --card-bg: var(--card-bg-light);
  --border-color: var(--border-color-light);
  --shadow-color: var(--shadow-color-light);
  --glass-bg: var(--glass-bg-light);
  --glass-border: var(--glass-border-light);
}

/* Layout */
.app-container {
  display: flex;
  min-height: calc(100vh - var(--header-height));
  padding-top: var(--header-height);
}

/* Header */
.header {
  height: var(--header-height);
  background-color: var(--card-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 0 2px 4px var(--shadow-color);
  display: flex;
  align-items: center;
  padding: 0 15px;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  transition: all var(--transition-duration);
  border-bottom: 1px solid var(--glass-border);
  border-radius: 0 0 6px 6px;
}

.logo {
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.logo i {
  font-size: 1.5rem;
}

.menu-toggle {
  background: none;
  border: none;
  color: var(--text-emphasis);
  font-size: 1.3rem;
  cursor: pointer;
  margin-right: 15px;
  display: none;
}

.header-actions {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 10px;
}

.theme-toggle {
  background: none;
  border: none;
  color: var(--text-emphasis);
  cursor: pointer;
  font-size: 1.2rem;
}

/* Sidebar */
.sidebar {
  width: var(--sidebar-width);
  background-color: var(--card-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(8px);
  box-shadow: 2px 0 4px var(--shadow-color);
  position: fixed;
  top: var(--header-height);
  left: 0;
  bottom: 0;
  transition: transform var(--transition-duration), background-color var(--transition-duration);
  overflow-y: auto;
  z-index: 90;
  border-right: 1px solid var(--glass-border);
  transform: translateX(0);
  border-radius: 0 6px 6px 0;
}

.sidebar-collapsed {
  transform: translateX(-100%);
}

.sidebar.show {
  transform: translateX(0);
}

.sidebar-menu {
  list-style: none;
  padding: 15px 0;
  margin: 0;
}

.menu-title {
  padding: 8px 15px;
  font-size: 0.75rem;
  text-transform: uppercase;
  color: var(--text-color);
  opacity: 0.7;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.menu-item {
  margin-bottom: 4px;
}

.menu-link {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  color: var(--text-color);
  text-decoration: none;
  transition: background-color var(--transition-duration), color var(--transition-duration);
  border-radius: 6px;
  margin: 0 8px;
}

.menu-link.protected::after {
    content: '\f023'; /* Font Awesome lock icon */
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    margin-left: auto;
    font-size: 0.8em;
    opacity: 0.6;
}

body.light-mode .menu-link:hover,
body.light-mode .menu-link.active {
  background-color: var(--primary-color);
  color: #ffffff;
}

body.dark-mode .menu-link:hover,
body.dark-mode .menu-link.active {
   background-color: var(--primary-color);
  color: #ffffff;
}

.menu-link i {
  margin-right: 10px;
  font-size: 1rem;
  width: 20px;
  text-align: center;
}

/* Main Content */
.main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    padding: 15px;
    transition: margin-left var(--transition-duration);
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    min-height: calc(100vh - var(--header-height));
}

.main-content-collapsed {
  margin-left: 0;
}

/* Cards */
.card {
   background-color: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(8px);
  border-radius: var(--border-radius);
  box-shadow: 0 2px 4px var(--shadow-color);
  padding: 15px;

  transition: background var(--transition-duration), box-shadow var(--transition-duration);
  border: 1px solid var(--border-color);
  overflow: hidden;
  margin-top: 20px;
}

.card-body {
  padding-top: 15px;
}

body.dark-mode .card {
  background-color: var(--glass-bg-dark);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--glass-border-dark);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border-color);
  flex-wrap: wrap;
  gap: 10px;
}

.card-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-emphasis);
  margin: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 8px 14px;
  border-radius: var(--border-radius);
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-duration);
  border: none;
  font-size: 0.85rem;
  white-space: nowrap;
  color: #ffffff;
box-shadow: 0 3px 8px rgba(0, 0, 0, 0.153);
}

.btn i {
  margin-right: 6px;
}

.btn-group {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.btn-primary { background-color: var(--primary-color); }
.btn-primary:hover { background-color: var(--accent-color); }

.btn-info { background-color: var(--accent-color); }
.btn-info:hover { background-color: #d67538; } /* Darker accent */

.btn-secondary { background-color: var(--secondary-color); }
.btn-secondary:hover { background-color: var(--accent-color); }

.btn-success { background-color: var(--success-color); }
.btn-success:hover { background-color: #218838; } /* Darker success */

.btn-danger { background-color: var(--danger-color); }
.btn-danger:hover { background-color: #c82333; } /* Darker danger */

.btn-warning { background-color: var(--warning-color); color: white; }
.btn-warning:hover { background-color: #e0a800; } /* Darker warning */

.btn-outline-primary {
  background-color: transparent;
  border: 1px solid var(--primary-color);
  color: var(--primary-color) !important;
}
.btn-outline-primary:hover { background-color: var(--primary-color); color: white !important; }

.btn-sm {
  padding: 5px 10px;
  font-size: 0.75rem;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Dashboard Stats */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.stat-card, .stat-card2 {
  display: flex;
  flex-direction: column;
  padding: 15px;
  border-radius: var(--border-radius);
   background-color: var(--glass-bg);
    backdrop-filter: blur(20px);
  box-shadow: 0 2px 4px var(--shadow-color);
  border: 1px solid var(--border-color);
}

body.dark-mode .stat-card,
body.dark-mode .stat-card2 {
  background-color: var(--glass-bg-dark);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--glass-border-dark);
}

.stat-title {
  font-size: 0.85rem;
  color: var(--text-color);
  opacity: 0.8;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-emphasis);
  margin-bottom: 8px;
  word-break: break-all;
}

.stat-change {
  font-size: 0.75rem;
  display: flex;
  align-items: center;
}

.stat-change i { margin-right: 4px; }
.stat-change.up { color: var(--success-color); }
.stat-change.down { color: var(--danger-color); }

/* Tables */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 10px 12px;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
  white-space: nowrap;
  color: var(--text-color);
  vertical-align: middle; /* Align content vertically */
}

.table td { color: var(--text-emphasis); }

.table th {
  font-weight: 600;
  color: var(--text-emphasis);
  background-color: var(--glass-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  position: sticky;
  top: 0;
  z-index: 10;
}

body.light-mode .table tbody tr:hover { background-color: rgba(255, 136, 57, 0.1); }
body.dark-mode .table tbody tr:hover { background-color: rgba(255, 136, 57, 0.1); }

.table td:last-child, .table th:last-child {
  text-align: right;
}

/* Order Details Section */
.row {
  display: flex;
  flex-wrap: wrap;
  margin-right: -15px;
  margin-left: -15px;
}

.col-md-8, .col-md-6, .col-md-4, .col-sm-12 {
  position: relative;
  width: 100%;
  padding-right: 15px;
  padding-left: 15px;
  box-sizing: border-box;
}

@media (min-width: 768px) {
  .col-md-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
  .col-md-6 { flex: 0 0 50%; max-width: 50%; }
  .col-md-8 { flex: 0 0 66.666667%; max-width: 66.666667%; }
}

.order-details {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 400px;
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
  flex-wrap: wrap;
  gap: 8px;
}

.order-header h3 { margin: 0; color: var(--text-emphasis); }

.order-items {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 15px;
  min-height: 150px;
}

.order-note-container {
    margin-bottom: 15px;
}

.order-note-container textarea {
    height: 60px;
    resize: vertical;
}

.order-summary {
  border-top: 2px solid var(--border-color);
  padding-top: 12px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  font-size: 0.9rem;
  color: var(--text-color);
}

.summary-label { font-weight: 600; }
.summary-value { font-weight: 700; color: var(--text-emphasis); }

.grand-total {
  font-size: 1.1rem;
  color: var(--primary-color);
}

.grand-total .summary-label, .grand-total .summary-value {
  font-weight: 700;
  color: var(--primary-color);
}

/* NEW: Style for served items in order list */
tr.item-served td {
    opacity: 0.6;
    text-decoration: line-through;
}

.served-checkbox, .received-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

/* Category Tabs */
.category-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
  overflow-x: auto;
  padding-bottom: 8px;
  white-space: nowrap;
}
.category-tabs::-webkit-scrollbar { display: none; }
.category-tabs { -ms-overflow-style: none; scrollbar-width: none; }

.category-tab {
  padding: 6px 12px;
  border-radius: 16px;
  background-color: var(--glass-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: var(--text-color);
  font-size: 0.85rem;
  cursor: pointer;
  transition: all var(--transition-duration);
  border: 1px solid var(--glass-border);
}

.category-tab:hover,
.category-tab.active {
  background-color: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

/* Products Grid (Default Desktop View) */
.products-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 15px;
}

.product-card {
  display: flex;
  flex-direction: column;
  border-radius: var(--border-radius);
  background: var(--card-bg);
  box-shadow: 0 2px 4px var(--shadow-color);
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  border: 1px solid var(--border-color);
  position: relative;
}

body.dark-mode .product-card {
  background-color: var(--glass-bg-dark);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--glass-border-dark);
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 8px var(--shadow-color);
}

.product-image {
  height: 120px;
  background-color: rgba(0, 0, 0, 0.05);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-emphasis);
  opacity: 0.8;
}
.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

body.dark-mode .product-image { background-color: rgba(0, 0, 0, 0.1); }
.product-image i { font-size: 2.5rem; }

.product-details { padding: 10px; text-align: center; }
.product-name {
  font-weight: 600;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.9rem;
  color: var(--text-emphasis);
}
.product-price {
  color: var(--primary-color);
  font-weight: 700;
  font-size: 0.85rem;
}

/* Forms */
.form-group { margin-bottom: 12px; }
.form-label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: var(--text-emphasis);
  font-size: 0.9rem;
}
.form-control {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background-color: var(--glass-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  color: var(--text-emphasis);
  transition: border-color var(--transition-duration), box-shadow var(--transition-duration);
  box-sizing: border-box;
  font-size: 0.9rem;
}

select.form-control {
  appearance: none;
  background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ff8839%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 10px 10px;
  padding-right: 30px;
}
body.dark-mode select.form-control {
  background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ff8839%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
}

.form-control:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(255, 136, 57, 0.2);
}

input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(59%) sepia(85%) saturate(1478%) hue-rotate(345deg) brightness(102%) contrast(101%);
}
body.dark-mode input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(59%) sepia(85%) saturate(1478%) hue-rotate(345deg) brightness(102%) contrast(101%);
}


/* Modals */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  overflow-y: auto;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  padding: 15px;
}
.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-dialog {
  width: 100%;
  max-width: 450px;
  background-color: var(--card-bg);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-radius: var(--border-radius);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  margin: auto;
  border: 1px solid var(--glass-border);
  display: flex;
  flex-direction: column;
  max-height: calc(100vh - 30px);
}
.modal-header {
  padding: 12px 15px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.modal-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-emphasis);
  margin: 0;
}
.modal-close {
  background: none; border: none;
  font-size: 1.5rem; color: var(--text-emphasis);
  opacity: 0.7; cursor: pointer; padding: 4px; line-height: 1;
}
.modal-close:hover { opacity: 1; }
.modal-body {
  padding: 15px;
  overflow-y: auto;
  color: var(--text-emphasis);
}
.modal-footer {
  padding: 12px 15px;
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  flex-wrap: wrap;
}
#report-modal .modal-dialog { max-width: 800px; }

/* Alerts */
.alert {
  padding: 12px 15px;
  border-radius: var(--border-radius);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: var(--glass-bg);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid var(--glass-border);
  font-size: 0.9rem;
  font-weight: bold;
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2000;
  display: none;
  min-width: 250px;
  box-shadow: 0 4px 12px var(--shadow-color);
}
.alert.show {
    display: flex;
}

.alert i { font-size: 1.1rem; }

body.light-mode .alert-success { background-color: rgba(40, 167, 69, 0.15); color: var(--success-color); border: 1px solid rgba(40, 167, 69, 0.3); }
body.dark-mode .alert-success { background-color: rgba(40, 167, 69, 0.2); color: var(--success-color); border-color: rgba(40, 167, 69, 0.3); }
body.light-mode .alert-danger { background-color: rgba(220, 53, 69, 0.15); color: var(--danger-color); border-color: rgba(220, 53, 69, 0.3); }
body.dark-mode .alert-danger { background-color: rgba(255, 68, 68, 0.2); color: var(--danger-color-dark); border-color: rgba(255, 68, 68, 0.3); }
body.light-mode .alert-warning { background-color: rgba(255, 193, 7, 0.15); color: var(--warning-color); border-color: rgba(255, 193, 7, 0.3); }
body.dark-mode .alert-warning { background-color: rgba(255, 193, 7, 0.2); color: var(--warning-color); border-color: rgba(255, 193, 7, 0.3); }


/* Empty State */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 30px 15px;
  text-align: center;
  color: var(--text-emphasis);
  opacity: 0.6;
  min-height: 150px;
}
.empty-state i {
  font-size: 2.5rem;
  margin-bottom: 12px;
  color: var(--border-color);
}
.empty-state p {
  font-size: 1rem;
  margin-bottom: 15px;
  color: var(--text-color);
}

/* Footer */
.footer {
  bottom: 0;
  left: 0;
  right: 0;
  background-color: var(--card-bg);
  color: var(--text-color);
  text-align: center;
  position: fixed;
  font-size: 0.8rem;
  z-index: 1000;
  border-top: 1px solid var(--glass-border);

}


/* Bottom Navigation Bar (Mobile Only) */
.bottom-nav {
    display: none; /* Hidden by default */
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 55px;
    background-color: var(--card-bg);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid var(--glass-border);
    justify-content: space-around;
    align-items: center;
    z-index: 1000;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -2px 10px var(--shadow-color)
}
.bottom-nav-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
    color: var(--text-color);
    text-decoration: none;
    font-size: 0.7rem;
    padding: 5px 0;
    transition: color 0.3s;
}
.bottom-nav-link i {
    font-size: 1.2rem;
    margin-bottom: 4px;

}
.bottom-nav-link.active {
    color: var(--primary-color);
}

/* Responsive Design */
@media (max-width: 991.98px) {
  .sidebar { transform: translateX(-100%); z-index: 110; }
  .sidebar.show { transform: translateX(0); }
  .main-content { margin-left: 0; }
  .main-content-collapsed { margin-left: 0; }
  .menu-toggle { display: block; }
  body.sidebar-open::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0, 0, 0, 0.4);
    z-index: 105;
  }
  .footer {
    left: 0;
    padding-left: 15px;

  }
}

@media (max-width: 767.98px) {
  .stats-grid { grid-template-columns: 1fr; }
  .order-details { margin-top: 15px; min-height: auto; }

  .products-grid {
    display: grid;
    grid-auto-flow: column;
    grid-template-rows: repeat(3, auto);
    grid-auto-columns: 120px; /* Width of each card */

    overflow-x: auto;
    gap: 12px;
    padding-bottom: 10px; /* Space for scrollbar if it appears */
    -webkit-overflow-scrolling: touch;

    grid-template-columns: unset; /* Unset the desktop property */
    flex-wrap: unset;
  }

  .products-grid::-webkit-scrollbar { display: none; }
  .products-grid { -ms-overflow-style: none; scrollbar-width: none; }
  .products-grid .product-card { width: auto; }

  .card { padding: 12px; }
  .card-title { font-size: 1rem; }
  .btn { padding: 6px 12px; font-size: 0.8rem; }
  .product-image { height: 100px; }
  .product-image i { font-size: 1.5rem; }
  .table th, .table td { padding: 8px 10px; }
  .row .col-md-6 { margin-bottom: 15px; }
  .row .col-md-6:last-child { margin-bottom: 0; }

  .footer {
    display: none; /* Hide original footer on mobile */
  }
  .bottom-nav {
    display: flex; /* Show new bottom nav on mobile */
  }
  .main-content {
      padding-bottom: 70px; /* Add padding to prevent content from being hidden by bottom nav */
  }
  .sidebar .hide-on-mobile {
      display: none; /* Hide specific sidebar items on mobile */
  }
}

@media (max-width: 575.98px) {
  .header { padding: 0 10px; }
  .logo { font-size: 1rem; }
  .logo i { font-size: 1.2rem; }
  .header-actions { gap: 8px; }
  .modal-dialog { max-width: calc(100% - 30px); margin: 15px auto; }
  #report-modal .modal-dialog { max-width: calc(100% - 30px); }
  .table th, .table td { padding: 6px 8px; font-size: 0.8rem; }
  .table .btn { padding: 4px 6px; font-size: 0.7rem; }

  .products-grid {
    grid-auto-columns: 110px; /* Make cards slightly smaller */
  }

  .product-image { height: 80px; }
  .product-details { padding: 8px; }
  .product-name, .product-price { font-size: 0.8rem; }
  .stat-value { font-size: 1.3rem; }
}

@media (max-width: 480px) {

    .footer{
        padding-top: 3px;
        padding-bottom: 3px;
      }
  .stats-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  }

  .stats-card2 {
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  }
}

/* --- NEW & UPDATED STYLES FOR RESTAURANT POS --- */

#activation-overlay, #login-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 9999;
  display: none; /* Initially hidden */
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}
#activation-modal, #login-modal {
  width: 100%;
  max-width: 350px;
  background-color: var(--card-bg);
  border-radius: var(--border-radius);
  padding: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  border: 1px solid var(--glass-border);
  text-align: center;
}
#activation-modal h3, #login-modal h3 {
    color: var(--text-emphasis);
    margin-top: 0;
    margin-bottom: 10px;
}
#activation-modal p, #login-modal p {
    color: var(--text-color);
    margin-bottom: 20px;
    font-size: 0.9rem;
}
#login-error, #activation-error, #password-error {
    color: var(--danger-color);
    display: none;
    margin-bottom: 10px;
    font-size: 0.85rem;
}

.filter-controls {
  display: flex;
  gap: 15px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  align-items: flex-end;
}
.search-box {
  position: relative;
  flex-grow: 1;
}
.search-box input {
  width: 100%;
  padding: 10px 15px 10px 35px;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  background-color: var(--glass-bg);
  color: var(--text-emphasis);
  box-sizing: border-box;
}
.search-box i {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-color);
}
#product-category-filter {
  flex-basis: 200px;
  flex-grow: 0;
}

.filter-group {
    display: flex;
    gap: 10px;
    align-items: center;
}
.filter-group label {
    margin: 0 5px 0 0;
    font-size: 0.85rem;
    white-space: nowrap;
}
.filter-options {
    flex-basis: 100%;
    display: flex;
    gap: 20px;
    margin-bottom: 10px;
}

.image-upload-container {
    margin-top: 10px;
    position: relative;
}
#product-image-preview {
    width: 100%;
    height: 150px;
    border-radius: var(--border-radius);
    object-fit: cover;
    border: 2px dashed var(--border-color);
    cursor: pointer;
}
#remove-image-btn {
    position: absolute;
    top: 5px;
    right: 5px;
}

.product-table-image {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s;
}
.product-table-image:hover {
    transform: scale(1.1);
}

#image-viewer-modal .modal-dialog {
    max-width: 80vw;
    background: transparent;
    border: none;
    box-shadow: none;
}
#full-size-image {
    max-width: 100%;
    max-height: 80vh;
    border-radius: var(--border-radius);
}

#receipt-modal .modal-dialog {
    max-width: 400px;
}
#receipt-content {
    padding: 20px;
    font-family: 'Courier New', Courier, monospace;
    color: var(--text-emphasis);
    background-color: var(--card-bg); /* Use card background for capture */
}
#receipt-content h4 {
    text-align: center;
    margin-top: 0;
    color: var(--primary-color);
}
#receipt-content p {
    font-size: 0.8rem;
    margin: 2px 0;
}
#receipt-content .receipt-divider {
    border-top: 1px dashed var(--text-color);
    margin: 10px 0;
}
#receipt-content table {
    width: 100%;
    font-size: 0.8rem;
}
#receipt-content th, #receipt-content td {
    padding: 2px;
}
#receipt-content .text-right {
    text-align: right;
}
#receipt-content .total-section {
    margin-top: 10px;
    font-weight: bold;
}
#receipt-content .footer-text {
    text-align: center;
    margin-top: 15px;
    font-size: 0.7rem;
}

.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-top: 20px;
}
.pagination-controls button {
    min-width: 35px;
}
#pagination-info, #category-pagination-info {
    font-size: 0.9rem;
    font-weight: 500;
}

#reset-confirm-input {
    margin-top: 10px;
}

/* --- POS TERMINAL (TABLE/PARCEL) STYLES --- */
.table-parcel-selector {
    display: flex;
    flex-direction: column;
    gap: 20px;
}
.selector-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
}
.selector-btn {
    padding: 15px 5px;
    font-size: 0.9rem;
    border: 1px solid var(--border-color);
    background-color: var(--glass-bg);
    color: var(--text-emphasis);
}
.selector-btn.has-order {
    background-color: var(--warning-color);
    color: white;
    border-color: var(--warning-color);
}
.selector-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}
#add-items-container {
    display: none; /* Hidden by default */
}

/* --- KITCHEN SECTION STYLES --- */
.kitchen-orders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
}
.kitchen-order-card {
    background-color: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 15px;
    display: flex;
    flex-direction: column;
}
.kitchen-order-card h3 {
    margin: 0 0 10px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
    color: var(--primary-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.kitchen-order-card h3 span:first-child {
    font-size: 1.2rem;
}
 .kitchen-order-card h3 .order-number {
    font-size: 0.9rem;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 16px;
    background-color: rgba(255, 136, 57, 0.2);
    color: var(--primary-color);
}
/* NEW: Add-on indicator style */
.addon-indicator {
    font-size: 0.8rem;
    font-weight: bold;
    color: var(--danger-color);
    margin-left: 8px;
}
.kitchen-order-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
}
.kitchen-order-card li {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 0.95rem;
}
 .kitchen-order-card li:not(:last-child) {
    border-bottom: 1px solid var(--border-color);
}
.kitchen-order-card .item-name {
    font-weight: 600;
    color: var(--text-emphasis);
}
 .kitchen-order-card .item-qty {
    font-weight: 700;
    color: var(--accent-color);
}
.kitchen-order-card .order-note {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px dashed var(--border-color);
    font-style: italic;
    font-size: 0.9rem;
    color: var(--text-color);
    white-space: pre-wrap;
}
 .kitchen-order-card .order-note strong {
    display: block;
    margin-bottom: 5px;
}


/* --- DATA SYNC (WebRTC) STYLES --- */
.webrtc-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
}
@media (min-width: 768px) {
    .webrtc-container {
        grid-template-columns: 1fr 1fr;
    }
}
.webrtc-status {
    padding: 10px;
    border-radius: var(--border-radius);
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
}
.webrtc-status.disconnected {
    background-color: rgba(220, 53, 69, 0.2);
    color: var(--danger-color);
}
body.dark-mode .webrtc-status.disconnected {
    background-color: rgba(255, 68, 68, 0.2);
    color: var(--danger-color-dark);
}
.webrtc-status.connecting {
    background-color: rgba(255, 193, 7, 0.2);
    color: var(--warning-color);
}
.webrtc-status.connected {
    background-color: rgba(40, 167, 69, 0.2);
    color: var(--success-color);
}
#data-sync-log {
    height: 200px;
    background-color: rgba(0,0,0,0.2);
    border-radius: var(--border-radius);
    padding: 10px;
    overflow-y: auto;
    font-size: 0.8rem;
    font-family: monospace;
    margin-top: 15px;
}
#data-sync-log p {
    margin: 0 0 5px 0;
    word-break: break-all;
}
</style></head> 
 <body> <!-- Activation Modal --> 
  <div id="activation-overlay"> 
   <div id="activation-modal"> 
    <div class="logo" style="justify-content: center; margin-bottom: 20px;"> <i class="fas fa-utensils"></i> <span data-translate="app_title">Restaurant POS</span> 
    </div> 
    <h3 data-translate="activation_title">Activation Required</h3> 
    <p data-translate="activation_prompt">Please enter today's activation code to continue.</p> 
    <div class="form-group"> 
     <input type="text" id="activation-code-input" class="form-control" placeholder="Activation Code"> 
    </div> 
    <div id="activation-error">
      Invalid Code 
    </div> <button id="activation-submit-btn" class="btn btn-primary" style="width: 100%;"><span data-translate="btn_activate">Activate</span></button> 
   </div> 
  </div> 
  <div id="alert-container"></div> 
  <header class="header"> <button class="menu-toggle"><i class="fas fa-bars"></i></button> 
   <div class="logo"> <i class="fas fa-utensils"></i><span>Amandalori</span> 
   </div> 
   <div class="header-actions"> <button class="theme-toggle"><i class="fas fa-moon"></i></button> 
   </div> 
  </header> 
  <div class="app-container"> 
   <aside class="sidebar"> 
    <ul class="sidebar-menu"> 
     <li class="menu-title" data-translate="menu_main">Main</li> 
     <li class="menu-item"><a href="#" class="menu-link active" data-section="orders"><i class="fas fa-cash-register"></i><span data-translate="menu_current_orders">POS Terminal</span></a></li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="kitchen"><i class="fas fa-concierge-bell"></i><span data-translate="menu_kitchen">Kitchen</span></a></li> 
     <li class="menu-title" data-translate="menu_management">Management</li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="products"><i class="fas fa-hamburger"></i><span data-translate="menu_menu_items">Menu Items</span></a></li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="categories"><i class="fas fa-tags"></i><span data-translate="menu_categories">Categories</span></a></li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="purchases"><i class="fas fa-truck-loading"></i><span data-translate="menu_purchases">Ingredient Purchases</span></a></li> 
     <li class="menu-title">Setting &amp; Info</li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="data-sync"><i class="fas fa-sync-alt"></i><span data-translate="menu_data_sync">Data Sync</span></a></li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="settings"><i class="fas fa-cog"></i><span data-translate="menu_settings">Settings</span></a></li> 
     <li class="menu-item"><a href="#" class="menu-link" data-section="about"><i class="fas fa-info-circle"></i><span data-translate="menu_about">About</span></a></li> 
    </ul> 
   </aside> 
   <main class="main-content"> 
    <section id="orders-section" class="content-section"> 
     <div class="row"> 
      <div class="col-md-8 col-sm-12"> <!-- Container for Table/Parcel Selector --> 
       <div id="table-parcel-selector-container" class="card"> 
        <div class="card-body table-parcel-selector"> 
         <div> 
          <h3 data-translate="title_tables">Tables</h3> 
          <div id="tables-grid" class="selector-grid"></div> 
         </div> 
         <div> 
          <h3 data-translate="title_parcels">Parcels</h3> 
          <div id="parcels-grid" class="selector-grid"></div> 
         </div> 
        </div> 
       </div> <!-- Container for Adding Items (Initially hidden) --> 
       <div id="add-items-container" class="card" style="display:none;"> 
        <div class="card-header"> <button id="back-to-selector-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> <span data-translate="btn_back">Back</span></button> 
         <div class="search-box" style="margin-left:15px; flex-grow:1;"> <i class="fas fa-search"></i> 
          <input type="text" id="product-search" data-translate-placeholder="placeholder_search_menu_items"> 
         </div> 
        </div> 
        <div class="category-tabs" id="category-tabs"></div> 
        <div id="products-grid" class="products-grid"> 
         <div class="empty-state"> <i class="fas fa-utensils"></i> 
          <p data-translate="empty_select_item">Select an item to begin sale</p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="col-md-4 col-sm-12"> 
       <div class="card order-details"> 
        <div class="order-header"> 
         <h3><span data-translate="label_order">Order for</span> #<span id="current-order-id">-</span></h3> 
         <div class="btn-group"> <button class="btn btn-secondary" type="button" id="send-order-btn" disabled><i class="fas fa-sync-alt"></i> <span data-translate="btn_send_order">Send</span></button> <button type="button" class="btn btn-danger" id="cancel-order-btn" disabled><i class="fas fa-times"></i> <span data-translate="btn_cancel">Cancel</span></button> 
         </div> 
        </div> 
        <div class="order-items"> 
         <table class="table"> 
          <thead> 
           <tr> 
            <th data-translate="table_item">Item</th> 
            <th data-translate="table_qty">Qty</th> 
            <th data-translate="table_price">Price</th> 
            <th data-translate="table_total">Total</th> 
            <th data-translate="table_served">Served</th> 
           </tr> 
          </thead> 
          <tbody id="order-items-list"> 
           <tr> 
            <td colspan="5"> 
             <div class="empty-state" style="min-height: 50px; padding: 10px;"> 
              <p style="font-size: 0.8rem; margin: 0;" data-translate="empty_no_items_added">No items added</p> 
             </div> </td> 
           </tr> 
          </tbody> 
         </table> 
        </div> 
        <div class="order-note-container"> <label for="order-note" class="form-label" data-translate="label_order_note">Order Note</label> <textarea id="order-note" class="form-control" data-translate-placeholder="placeholder_order_note"></textarea> 
        </div> 
        <div class="order-summary"> 
         <div class="summary-row"> <span class="summary-label" data-translate="label_subtotal">Subtotal:</span> <span class="summary-value" id="order-subtotal">0 ကျပ်</span> 
         </div> 
         <div class="summary-row"> <span class="summary-label" data-translate="label_discount">Discount</span> 
          <input type="number" id="order-discount" class="form-control" value="0" min="0" style="max-width: 120px; text-align: right; padding: 2px 8px; font-size: 0.9rem; height: auto;"> 
         </div> 
         <div class="summary-row"> <span class="summary-label" id="order-tax-label">Tax (0%):</span> <span class="summary-value" id="order-tax">0 ကျပ်</span> 
         </div> 
         <div class="summary-row grand-total"> <span class="summary-label" data-translate="label_grand_total">Grand Total:</span> <span class="summary-value" id="order-total">0 ကျပ်</span> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </section> 
    <section id="kitchen-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="kitchen_title">Kitchen Orders</h2> 
      </div> 
      <div class="card-body"> 
       <div id="kitchen-orders-grid" class="kitchen-orders-grid"> <!-- Kitchen order cards will be rendered here --> 
       </div> 
      </div> 
     </div> 
    </section> 
    <section id="products-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_menu_items">Menu Items</h2> 
       <div class="btn-group"> <button class="btn btn-primary" type="button" id="add-new-product-btn"><i class="fas fa-plus"></i> <span data-translate="btn_add_menu_item">Add Menu Item</span></button> 
       </div> 
      </div> 
      <div class="filter-controls"> 
       <div class="search-box"> <i class="fas fa-search"></i> 
        <input type="text" id="products-search-input" data-translate-placeholder="placeholder_search_menu_items"> 
       </div> <select id="product-category-filter" class="form-control"> <option value="all" data-translate="filter_all_categories">All Categories</option> </select> 
      </div> 
      <div class="table-responsive"> 
       <table class="table"> 
        <thead> 
         <tr> 
          <th data-translate="table_image">Image</th> 
          <th data-translate="table_name">Name</th> 
          <th data-translate="table_category">Category</th> 
          <th data-translate="label_price">Price</th> 
          <th data-translate="table_actions">Actions</th> 
         </tr> 
        </thead> 
        <tbody id="products-table"> 
        </tbody> 
       </table> 
      </div> 
      <div class="pagination-controls" id="products-pagination" style="display: none;"> <button class="btn btn-secondary" id="prev-page-btn" disabled><i class="fas fa-chevron-left"></i></button> <span id="pagination-info">Page 1 of 1</span> <button class="btn btn-secondary" id="next-page-btn" disabled><i class="fas fa-chevron-right"></i></button> 
      </div> 
     </div> 
    </section> 
    <section id="categories-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_categories">Categories</h2> 
       <div class="btn-group"> <button class="btn btn-primary" type="button" id="add-new-category-btn"><i class="fas fa-plus"></i> <span data-translate="btn_add_category">Add Category</span></button> 
       </div> 
      </div> 
      <div class="table-responsive"> 
       <table class="table"> 
        <thead> 
         <tr> 
          <th data-translate="table_name">Name</th> 
          <th data-translate="table_item_count">Item Count</th> 
          <th data-translate="table_actions">Actions</th> 
         </tr> 
        </thead> 
        <tbody id="categories-table"> 
        </tbody> 
       </table> 
      </div> 
      <div class="pagination-controls" id="categories-pagination" style="display: none;"> <button class="btn btn-secondary" id="prev-category-page-btn" disabled><i class="fas fa-chevron-left"></i></button> <span id="category-pagination-info">Page 1 of 1</span> <button class="btn btn-secondary" id="next-category-page-btn" disabled><i class="fas fa-chevron-right"></i></button> 
      </div> 
     </div> 
    </section> 
    <section id="purchases-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_purchases">Ingredient Purchases</h2> 
       <div class="btn-group"> <button class="btn btn-primary" type="button" id="add-new-purchase-btn"><i class="fas fa-plus"></i> <span data-translate="btn_add_purchase">Add Purchase</span></button> 
       </div> 
      </div> 
      <div class="filter-controls"> 
       <div class="filter-group"> <label data-translate="label_filter_by">Filter by:</label> 
        <div id="purchase-filter-type"> 
         <input type="radio" id="filter-all-purchases" name="purchase-filter-type" value="all" checked> <label for="filter-all-purchases" data-translate="filter_all">All</label> 
         <input type="radio" id="filter-date-purchases" name="purchase-filter-type" value="date"> <label for="filter-date-purchases" data-translate="filter_by_date">By Date</label> 
         <input type="radio" id="filter-month-purchases" name="purchase-filter-type" value="month"> <label for="filter-month-purchases" data-translate="filter_by_month">By Month</label> 
        </div> 
       </div> 
       <div id="purchase-date-filter-group" class="filter-group" style="display: none;"> <label for="purchase-filter-date" data-translate="label_date">Date:</label> 
        <input type="date" id="purchase-filter-date" class="form-control"> 
       </div> 
       <div id="purchase-month-filter-group" class="filter-group" style="display: none;"> <label for="purchase-filter-month" data-translate="label_month">Month:</label> <select id="purchase-filter-month" class="form-control"></select> <label for="purchase-filter-year" data-translate="label_year">Year:</label> <select id="purchase-filter-year" class="form-control"></select> 
       </div> 
       <div class="btn-group"> <button class="btn btn-primary" id="apply-purchase-filter-btn" data-translate="btn_apply_filter">Apply Filter</button> <button class="btn btn-secondary" id="clear-purchase-filter-btn" data-translate="btn_clear_filter">Clear Filter</button> 
       </div> 
      </div> 
      <div class="table-responsive"> 
       <table class="table"> 
        <thead> 
         <tr> 
          <th data-translate="table_item_ingredient">Item/Ingredient Name</th> 
          <th data-translate="table_quantity">Quantity</th> 
          <th data-translate="table_total_cost">Total Cost</th> 
          <th data-translate="table_date">Date</th> 
          <th data-translate="table_received_status">Received</th> 
          <th data-translate="table_actions">Actions</th> 
         </tr> 
        </thead> 
        <tbody id="purchases-table"> 
         <tr> 
          <td colspan="6"> 
           <div class="empty-state"> <i class="fas fa-shopping-cart"></i> 
            <p data-translate="empty_no_purchases">No purchases found</p> 
           </div> </td> 
         </tr> 
        </tbody> 
       </table> 
      </div> 
     </div> 
    </section> <!-- Data Sync (WebRTC) Section --> 
    <section id="data-sync-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_data_sync">Data Sync (WebRTC)</h2> 
      </div> 
      <div class="card-body webrtc-container"> 
       <div class="card"> 
        <div class="card-header"> 
         <h3 class="card-title" data-translate="title_connection">Connection</h3> 
         <span id="webrtc-peer-count" style="font-size: 0.9rem; font-weight: bold;"></span> 
        </div> 
        <div class="card-body"> 
         <div id="webrtc-status" class="webrtc-status disconnected" data-translate="status_disconnected">
           Disconnected 
         </div> 
         <div class="form-group"> <label for="my-peer-id" class="form-label" data-translate="label_your_peer_id">Your Peer ID</label> 
          <input type="text" id="my-peer-id" class="form-control" readonly> 
         </div> 
         <div class="form-group"> <label for="peer-id-input" class="form-label" data-translate="label_connect_to_peer">Connect to Peer ID</label> 
          <input type="text" id="peer-id-input" class="form-control"> 
         </div> <button id="connect-peer-btn" class="btn btn-primary" data-translate="btn_connect">Connect</button> 
        </div> 
       </div> 
       <div class="card"> 
        <div class="card-header"> 
         <h3 class="card-title" data-translate="title_data_transfer">Data Transfer</h3> 
        </div> 
        <div class="card-body"> 
         <div class="btn-group" style="flex-direction: column;"> <button id="send-products-btn" class="btn btn-secondary" data-translate="btn_send_menu_data">Send Menu Data</button> <button id="send-all-orders-btn" class="btn btn-secondary" data-translate="btn_send_all_orders">Send All Active Orders</button> <button id="send-purchases-btn" class="btn btn-secondary" data-translate="btn_send_purchases">Send Purchases Data</button> 
         </div> 
         <div id="data-sync-log"></div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </section> 
    <section id="settings-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_settings">Settings</h2> 
      </div> 
      <div class="card-body"> 
       <div class="card" style="margin-top:0;"> 
        <div class="card-header"> 
         <h3 class="card-title" data-translate="title_general_settings">General Settings</h3> 
        </div> 
        <div class="card-body"> 
         <div class="form-group"> <label for="tax-rate-setting" class="form-label" data-translate="label_tax_rate">Tax Rate (%)</label> 
          <input type="number" id="tax-rate-setting" class="form-control" min="0" step="0.1"> 
         </div> 
         <div class="form-group"> <label for="receipt-title-setting" class="form-label" data-translate="label_receipt_title">Receipt Title</label> 
          <input type="text" id="receipt-title-setting" class="form-control" placeholder="Restaurant Name"> 
         </div> 
         <div class="form-group"> <label for="language-select" class="form-label" data-translate="label_language">Language</label> <select id="language-select" class="form-control"> <option value="en">English</option> <option value="mm">မြန်မာ</option> <option value="jp">日本語</option> </select> 
         </div> 
        </div> 
       </div> 
       <div class="form-group" style="margin-top: 20px;"> <button class="btn btn-primary" type="button" id="save-settings-btn"><i class="fas fa-save"></i> <span data-translate="btn_save_settings">Save Settings</span></button> 
       </div> 
      </div> 
     </div> 
    </section> 
    <section id="about-section" class="content-section" style="display: none;"> 
     <div class="card"> 
      <div class="card-header"> 
       <h2 class="card-title" data-translate="menu_about">About</h2> 
      </div> 
      <div class="card-body about-content"> 
       <h3 data-translate="about_title">Restaurant POS System</h3> 
       <p data-translate="about_version">Version Lite 1.0</p> 
       <p data-translate="about_description">This is a modern Point of Sale system designed for restaurants. It provides features for order management, inventory tracking, and sales reporting.</p> 
       <h3 data-translate="about_features_title">Features</h3> 
       <ul data-translate="about_features_list" data-translate-type="list"> 
       </ul> 
       <h3 data-translate="about_developer_title">Developer</h3> 
       <p>©️ Aung Kaung Myat production</p> 
      </div> 
     </div> 
    </section> 
   </main> 
  </div> 
  <br> 
  <footer class="footer"> 
   <p>©️ Aung Kaung Myat production</p> 
  </footer> 
  <nav class="bottom-nav"> <a href="#" class="bottom-nav-link active" data-section="orders"> <i class="fas fa-cash-register"></i> </a> <a href="#" class="bottom-nav-link" data-section="kitchen"> <i class="fas fa-concierge-bell"></i> </a> <a href="#" class="bottom-nav-link" data-section="products"> <i class="fas fa-hamburger"></i> </a> <a href="#" class="bottom-nav-link" data-section="purchases"> <i class="fas fa-truck-loading"></i> </a> 
  </nav> <!-- Modals --> 
  <div class="modal" id="product-modal"> 
   <div class="modal-dialog"> 
    <div class="modal-content"> 
     <div class="modal-header"> 
      <h3 class="modal-title" id="product-modal-title" data-translate="modal_add_menu_item_title">Add Menu Item</h3> <button type="button" class="modal-close">×</button> 
     </div> 
     <div class="modal-body"> 
      <form id="product-form"> 
       <input type="hidden" id="product-id"> 
       <div class="form-group"> <label for="product-name" class="form-label" data-translate="label_menu_item_name">Menu Item Name</label> 
        <input type="text" id="product-name" class="form-control" required> 
       </div> 
       <div class="form-group"> <label for="product-category" class="form-label" data-translate="label_category">Category</label> <select id="product-category" class="form-control" required> <option value="" data-translate="placeholder_select_category">Select Category</option> </select> 
       </div> 
       <div class="form-group"> <label for="product-price" class="form-label" data-translate="label_price">Price</label> 
        <input type="number" id="product-price" class="form-control" min="0" step="100" required> 
       </div> 
       <div class="form-group"> <label for="product-image-upload" class="form-label" data-translate="label_item_image">Item Image</label> 
        <input type="file" id="product-image-upload" class="form-control" accept="image/"> 
        <div class="image-upload-container"> 
         <img id="product-image-preview" src="" alt="Image Preview" style="display: none;"> <button type="button" id="remove-image-btn" class="btn btn-sm btn-danger" style="display: none;"><i class="fas fa-times"></i></button> 
        </div> 
       </div> 
      </form> 
     </div> 
     <div class="modal-footer"> <button type="button" class="btn btn-secondary modal-close"><span data-translate="btn_cancel">Cancel</span></button> <button type="button" class="btn btn-danger" id="delete-product-btn" style="display: none;"><i class="fas fa-trash"></i> <span data-translate="btn_delete">Delete</span></button> <button type="button" class="btn btn-primary" id="save-product-btn"><span data-translate="btn_save_item">Save Item</span></button> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="modal" id="category-modal"> 
   <div class="modal-dialog"> 
    <div class="modal-content"> 
     <div class="modal-header"> 
      <h3 class="modal-title" id="category-modal-title" data-translate="modal_add_category_title">Add Category</h3> <button type="button" class="modal-close">×</button> 
     </div> 
     <div class="modal-body"> 
      <form id="category-form"> 
       <input type="hidden" id="category-id"> 
       <div class="form-group"> <label for="category-name" class="form-label" data-translate="label_category_name">Category Name</label> 
        <input type="text" id="category-name" class="form-control" required> 
       </div> 
      </form> 
     </div> 
     <div class="modal-footer"> <button type="button" class="btn btn-secondary modal-close"><span data-translate="btn_cancel">Cancel</span></button> <button type="button" class="btn btn-danger" id="delete-category-btn" style="display: none;"><i class="fas fa-trash"></i> <span data-translate="btn_delete">Delete</span></button> <button type="button" class="btn btn-primary" id="save-category-btn"><span data-translate="btn_save">Save</span></button> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="modal" id="purchase-modal"> 
   <div class="modal-dialog"> 
    <div class="modal-content"> 
     <div class="modal-header"> 
      <h3 class="modal-title" id="purchase-modal-title" data-translate="modal_add_purchase_title">Add Ingredient Purchase</h3> <button type="button" class="modal-close">×</button> 
     </div> 
     <div class="modal-body"> 
      <form id="purchase-form"> 
       <input type="hidden" id="purchase-id"> 
       <div class="form-group"> <label for="purchase-item-name" class="form-label" data-translate="label_item_ingredient">Item / Ingredient Name</label> 
        <input type="text" id="purchase-item-name" class="form-control" required> 
       </div> 
       <div class="form-group"> <label for="purchase-quantity" class="form-label" data-translate="label_quantity">Quantity</label> 
        <input type="number" id="purchase-quantity" class="form-control" min="1" required> 
       </div> 
       <div class="form-group"> <label for="purchase-unit-cost" class="form-label" data-translate="label_unit_cost">Unit Cost</label> 
        <input type="number" id="purchase-unit-cost" class="form-control" min="0" step="100" required> 
       </div> 
       <div class="form-group"> <label for="purchase-total-cost" class="form-label" data-translate="label_total_cost">Total Cost</label> 
        <input type="number" id="purchase-total-cost" class="form-control" min="0" step="100"> 
       </div> 
       <div class="form-group"> <label for="purchase-date" class="form-label" data-translate="label_date_time">Date &amp; Time</label> 
        <input type="datetime-local" id="purchase-date" class="form-control" required> 
       </div> 
      </form> 
     </div> 
     <div class="modal-footer"> <button type="button" class="btn btn-secondary modal-close"><span data-translate="btn_cancel">Cancel</span></button> <button type="button" class="btn btn-primary" id="save-purchase-btn"><span data-translate="btn_save_purchase">Save Purchase</span></button> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="modal" id="confirm-modal"> 
   <div class="modal-dialog"> 
    <div class="modal-content"> 
     <div class="modal-header"> 
      <h3 class="modal-title" id="confirm-modal-title">Confirm Action</h3> <button type="button" class="modal-close">×</button> 
     </div> 
     <div class="modal-body"> 
      <p id="confirm-message">Are you sure?</p> 
     </div> 
     <div class="modal-footer"> <button type="button" class="btn btn-secondary modal-close" id="confirm-cancel-btn"><span data-translate="btn_cancel">Cancel</span></button> <button type="button" class="btn btn-danger" id="confirm-ok-btn"><span data-translate="btn_confirm">Confirm</span></button> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="modal" id="image-viewer-modal"> 
   <div class="modal-dialog"> <button type="button" class="modal-close" style="position: absolute; top: 10px; right: 10px; z-index: 1; font-size: 2rem;">×</button> 
    <img id="full-size-image" src="" alt="Full-size Item Image"> 
   </div> 
  </div> 
 
<script type="text/javascript" id="dcoder_script">document.addEventListener('DOMContentLoaded', () => {

    // --- START ACTIVATION LOGIC ---
    function checkActivation() {
        const isActivated = localStorage.getItem('Restaurant_POS_isActivated_Lite') === 'true';
        if (isActivated) {
            document.getElementById('activation-overlay').style.display = 'none';
            init(); // Proceed to normal initialization
        } else {
            document.querySelector('.app-container').style.display = 'none';
            document.querySelector('.header').style.display = 'none';
            document.getElementById('activation-overlay').style.display = 'flex';
            setupActivationListener();
            const theme = localStorage.getItem('theme') || 'dark';
            document.body.className = `${theme}-mode`;
        }
    }

    function setupActivationListener() {
        const submitBtn = document.getElementById('activation-submit-btn');
        const input = document.getElementById('activation-code-input');
        const errorMsg = document.getElementById('activation-error');

        submitBtn.addEventListener('click', () => {
            const userInput = input.value.trim();
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            const dateString = `${year}${month}${day}`;
            const secretKey = '26202923d939fdj22ef'; // Secret key remains the same
            const correctCode = `${dateString}${secretKey}`;

            if (userInput === correctCode) {
                localStorage.setItem('Restaurant_POS_isActivated_Lite', 'true');
                document.getElementById('activation-overlay').style.display = 'none';
                document.querySelector('.app-container').style.display = 'flex';
                document.querySelector('.header').style.display = 'flex';
                init();
            } else {
                errorMsg.style.display = 'block';
                input.value = '';
                input.focus();
            }
        });

        input.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitBtn.click();
            }
        });
    }
    // --- END ACTIVATION LOGIC ---

    // ---------------------------------------------------------------------------
    //  1. Database Setup with IndexedDB
    // ---------------------------------------------------------------------------

    const DB_NAME = 'Rspost02a07_Lite'; // Use a different DB name for the lite version
    const DB_VERSION = 1; // Incremented version to handle schema change for purchases
    let dbInstance;
    let itemToDelete = null;

    const notificationSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAB/8AAAAB8AAgE4b2RlY2sAAAD0AAAAEAAAAAAAZVoAAAABnVoAAAArt1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dX//tAwRAAAAHwAHAEQf/zk+V1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1f/9wEaQAAAAAAAAAAAAAAAAD/9wEaQVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/9wEaQVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVK//+5kR+Acrk63/8+3/5/c07///uX//+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/+//v/7/--//+8A0EAAAAAAAAAAA//8AQCgAP//7gAAAA4AAAAAAEVNQUZDAAEAAABT//UAU//8ANQAAAANAAANIA0AANQ0ADQDSAAAA0g0AAAAADQAAAAADQAAAAAP//7gAAAAAAAAAAAD/6AAAAAAAAAAAAA//uA0gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQD/xAAMA/8AAAAADQA0AA8A/8ANAAAAAAAAAAAAAAADQAwA0AAAADQAw//4ADQAA//+4A//uADQD/ADAAAAAAAAAAAAA/8AAAAAADSAAAADSDQDSAAAAAAAAAAANAAAAAAP//uAAAAADSAAAAAAAAAAAAAA//+4AwAAAAAAAAAAAAAAAAD/wA0A/8AAAADQDQAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAAAAAAA//uAAAAAAAAAAAAA//uAAAAAAAAAAAADQDQDQAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAAAANAAAAAADQDQAAAAAAAAAAAAAADQDSAAAAAAANANANANAAAAAANANAAAAAAAAAANANAAAAAANANANANANAAAAAAAAAAAAAAAAAANANAAAAAAP//uANANAAAAAAP/7gAAAAAAAAAAAP/gAAAAAAAAAAAA/+4A//+4A0AAAAAAAAAAAAAA//+4AAAAAAAAAAAAA//+4AAAAAAAAAAAAA/+4A//+4A//+4AwAAAAAAAAAAAAAADQD/7gAAAAAAAAAAAAAAP/gADQAAAAAAAAAAAAAADQD/7gD/7gAAAAAAAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAAD/7gAAAAADQAAAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAA//+4AAAAAAAAAAAAA//+4A//+4A0AAAAAAAAAAAAAAD/7gAAAAAAAAAAAAAAD/7gAAAAADQDQAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAAD/7gAAAAADQDQAAAAAAAAAAAP/uAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAP/uAAAAAAAAAAAAAAD/7gD/7gAAAAADQDQAAAAAAAAAAAAAAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAAAAAAAAAAAAAAD/7gAAAAAAAAAAAAD/7gAAAAADQDQAAAAAAAAAAAP/uAP/uAAAAAAAAAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAP/uAP/uAP/uAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAP/uAP/uAP/uAP/uAP/uAAAAAAAAAAAAAAD/7gD/7gD/7gD/7gD/7gD/7gAAAAADQDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');

    const openDatabase = () => {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                const transaction = event.target.transaction;

                if (!db.objectStoreNames.contains('products')) {
                    const productsStore = db.createObjectStore('products', { keyPath: 'id' });
                    productsStore.createIndex('categoryId', 'categoryId', { unique: false });
                    productsStore.createIndex('name', 'name', { unique: false });
                }
                if (!db.objectStoreNames.contains('categories')) {
                    db.createObjectStore('categories', { keyPath: 'id' });
                }
                // Updated schema for purchases
                if (!db.objectStoreNames.contains('purchases')) {
                    const purchasesStore = db.createObjectStore('purchases', { keyPath: 'id' });
                    purchasesStore.createIndex('dateTime', 'dateTime', { unique: false });
                } else {
                    // This handles migration if the old store exists
                    const purchasesStore = transaction.objectStore('purchases');
                    if (!purchasesStore.indexNames.contains('dateTime')) {
                         purchasesStore.createIndex('dateTime', 'dateTime', { unique: false });
                    }
                }
                if (!db.objectStoreNames.contains('orders')) {
                   const ordersStore = db.createObjectStore('orders', { keyPath: 'id' });
                    ordersStore.createIndex('date', 'date', { unique: false });
                    ordersStore.createIndex('status', 'status', { unique: false });
                    ordersStore.createIndex('tableOrParcelId', 'tableOrParcelId', { unique: false });
                }
                if (!db.objectStoreNames.contains('settings')) {
                    db.createObjectStore('settings', { keyPath: 'key' });
                }
            };
            
            request.onsuccess = (event) => {
                dbInstance = event.target.result;
                resolve(dbInstance);
            };
            
            request.onerror = (event) => {
                console.error('Database error:', event.target.error);
                reject(event.target.error);
            };
        });
    };

    const db = {
        add: (storeName, item) => new Promise((resolve, reject) => {
            const t = dbInstance.transaction(storeName, 'readwrite');
            t.oncomplete = () => resolve(item);
            t.onerror = event => reject(event.target.error);
            t.objectStore(storeName).add(item);
        }),
        put: (storeName, item) => new Promise((resolve, reject) => {
            const t = dbInstance.transaction(storeName, 'readwrite');
            t.oncomplete = () => resolve(item);
            t.onerror = event => reject(event.target.error);
            t.objectStore(storeName).put(item);
        }),
        get: (storeName, key) => new Promise((resolve, reject) => {
            const t = dbInstance.transaction(storeName, 'readonly');
            const request = t.objectStore(storeName).get(key);
            request.onsuccess = () => resolve(request.result);
            request.onerror = event => reject(event.target.error);
        }),
        getAll: (storeName, indexName, range) => new Promise((resolve, reject) => {
            const store = dbInstance.transaction(storeName, 'readonly').objectStore(storeName);
            const target = indexName ? store.index(indexName) : store;
            const request = range ? target.getAll(range) : target.getAll();
            request.onsuccess = () => resolve(request.result);
            request.onerror = event => reject(event.target.error);
        }),
        delete: (storeName, key) => new Promise((resolve, reject) => {
            const t = dbInstance.transaction(storeName, 'readwrite');
            t.oncomplete = () => resolve();
            t.onerror = event => reject(event.target.error);
            t.objectStore(storeName).delete(key);
        }),
        count: (storeName, indexName, range) => new Promise((resolve, reject) => {
            const store = dbInstance.transaction(storeName, 'readonly').objectStore(storeName);
            const target = indexName ? store.index(indexName) : store;
            const request = range ? target.count(range) : target.count();
            request.onsuccess = () => resolve(request.result);
            request.onerror = event => reject(event.target.error);
        }),
    };

    const initSampleData = async () => {
        const productCount = await db.count('products');
        if (productCount > 0) return;
        
        const categories = [ { id: 'cat1', name: 'Appetizers' }, { id: 'cat2', name: 'Main Course' }, { id: 'cat3', name: 'Drinks' }];
        const products = [
            { id: 'food1', categoryId: 'cat1', name: 'Spring Rolls', price: 3000, image: null },
            { id: 'food2', categoryId: 'cat2', name: 'Fried Rice', price: 4500, image: null },
            { id: 'food3', categoryId: 'cat3', name: 'Cola', price: 1000, image: null },
            { id: 'food4', categoryId: 'cat2', name: 'Chicken Burger', price: 5000, image: null },
        ];
        
        try {
            await Promise.all(categories.map(c => db.add('categories', c)));
            await Promise.all(products.map(p => db.add('products', p)));
            await db.put('settings', { key: 'theme', value: 'dark' });
            await db.put('settings', { key: 'language', value: 'mm' });
            await db.put('settings', { key: 'taxRate', value: 5 });
            await db.put('settings', { key: 'receiptTitle', value: 'My Restaurant' });
        } catch (error) {
            console.error('Error initializing sample data:', error);
        }
    };


    // ---------------------------------------------------------------------------
    //  2. Application State, UI Elements
    // ---------------------------------------------------------------------------
    const state = {
        currentSection: 'orders', // Default to POS terminal
        activeOrders: {}, 
        activeTableOrParcelId: null,
        taxRate: 0,
        currentLanguage: 'en',
        productsPage: 1,
        productsPerPage: 10,
        categoriesPage: 1,
        categoriesPerPage: 10,
    };

    const UIElements = {
        sidebar: document.querySelector('.sidebar'),
        mainContent: document.querySelector('.main-content'),
        menuToggle: document.querySelector('.menu-toggle'),
        themeToggle: document.querySelector('.theme-toggle'),
        sections: document.querySelectorAll('.content-section'),
        sidebarLinks: document.querySelectorAll('.menu-link'),
        bottomNav: document.querySelector('.bottom-nav'),
        bottomNavLinks: document.querySelectorAll('.bottom-nav-link'),
        productModal: document.getElementById('product-modal'),
        productsTableBody: document.getElementById('products-table'),
        productsSearchInput: document.getElementById('products-search-input'),
        productCategoryFilter: document.getElementById('product-category-filter'),
        productsPagination: document.getElementById('products-pagination'),
        prevPageBtn: document.getElementById('prev-page-btn'),
        nextPageBtn: document.getElementById('next-page-btn'),
        paginationInfo: document.getElementById('pagination-info'),
        categoriesTableBody: document.getElementById('categories-table'),
        categoriesPagination: document.getElementById('categories-pagination'),
        prevCategoryPageBtn: document.getElementById('prev-category-page-btn'),
        nextCategoryPageBtn: document.getElementById('next-category-page-btn'),
        categoryPaginationInfo: document.getElementById('category-pagination-info'),
        categoryTabs: document.getElementById('category-tabs'),
        productsGrid: document.getElementById('products-grid'),
        currentOrderId: document.getElementById('current-order-id'),
        orderItemsList: document.getElementById('order-items-list'),
        orderNote: document.getElementById('order-note'),
        orderSubtotal: document.getElementById('order-subtotal'),
        orderDiscountInput: document.getElementById('order-discount'),
        orderTax: document.getElementById('order-tax'),
        orderTaxLabel: document.getElementById('order-tax-label'),
        orderTotal: document.getElementById('order-total'),
        cancelOrderBtn: document.getElementById('cancel-order-btn'),
        sendOrderBtn: document.getElementById('send-order-btn'),
        purchaseModal: document.getElementById('purchase-modal'),
        taxRateSetting: document.getElementById('tax-rate-setting'),
        receiptTitleSetting: document.getElementById('receipt-title-setting'),
        languageSelect: document.getElementById('language-select'),
        purchaseFilterType: document.getElementById('purchase-filter-type'),
        purchaseDateFilterGroup: document.getElementById('purchase-date-filter-group'),
        purchaseMonthFilterGroup: document.getElementById('purchase-month-filter-group'),
        purchaseFilterDate: document.getElementById('purchase-filter-date'),
        purchaseFilterMonth: document.getElementById('purchase-filter-month'),
        purchaseFilterYear: document.getElementById('purchase-filter-year'),
        tableParcelSelectorContainer: document.getElementById('table-parcel-selector-container'),
        addItemsContainer: document.getElementById('add-items-container'),
        tablesGrid: document.getElementById('tables-grid'),
        parcelsGrid: document.getElementById('parcels-grid'),
        backToSelectorBtn: document.getElementById('back-to-selector-btn'),
        kitchenOrdersGrid: document.getElementById('kitchen-orders-grid'),
    };

    // ---------------------------------------------------------------------------
    //  3. Rendering & UI Updates
    // ---------------------------------------------------------------------------
    
    function showAlert(message, type = 'success') {
        const alertContainer = document.getElementById('alert-container');
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i><span>${message}</span>`;
        alertContainer.appendChild(alertDiv);
        alertDiv.classList.add('show');
        setTimeout(() => {
            alertDiv.classList.remove('show');
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertContainer.removeChild(alertDiv);
                }
            }, 500);
        }, 3000);
    }

    async function render() {
        UIElements.sections.forEach(sec => sec.style.display = 'none');
        const currentSectionEl = document.getElementById(`${state.currentSection}-section`);
        if (currentSectionEl) {
            currentSectionEl.style.display = 'block';
        }
        
        switch (state.currentSection) {
            case 'products': await renderMenuItemsPage(); break;
            case 'categories': await renderCategoriesPage(); break;
            case 'orders': await renderOrdersPage(); break;
            case 'kitchen': await renderKitchenPage(); break;
            case 'purchases': await renderPurchasesPage(); break;
            case 'settings': await renderSettingsPage(); break;
            case 'data-sync': await renderDataSyncPage(); break;
        }

        UIElements.sidebarLinks.forEach(link => {
            link.classList.toggle('active', link.dataset.section === state.currentSection);
        });
        UIElements.bottomNavLinks.forEach(link => {
            link.classList.toggle('active', link.dataset.section === state.currentSection);
        });
    }

    async function renderMenuItemsPage() {
        const searchTerm = UIElements.productsSearchInput.value.toLowerCase();
        const categoryFilter = UIElements.productCategoryFilter.value;
        const allProducts = await db.getAll('products');
        const filteredProducts = allProducts.filter(p => {
            const matchesSearch = p.name.toLowerCase().includes(searchTerm);
            const matchesCategory = (categoryFilter === 'all' || p.categoryId === categoryFilter);
            return matchesSearch && matchesCategory;
        });
        const totalPages = Math.ceil(filteredProducts.length / state.productsPerPage) || 1;
        state.productsPage = Math.min(state.productsPage, totalPages);
        const startIndex = (state.productsPage - 1) * state.productsPerPage;
        const endIndex = startIndex + state.productsPerPage;
        const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

        if (paginatedProducts.length === 0 && searchTerm === '' && categoryFilter === 'all') {
             UIElements.productsTableBody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><i class="fas fa-hamburger"></i><p>${getTranslation('empty_no_menu_items_yet')}</p></div></td></tr>`;
             UIElements.productsPagination.style.display = 'none';
        } else if (paginatedProducts.length === 0) {
            UIElements.productsTableBody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><i class="fas fa-search"></i><p>${getTranslation('empty_no_menu_items_match')}</p></div></td></tr>`;
            UIElements.productsPagination.style.display = 'none';
        } else {
            UIElements.productsPagination.style.display = 'flex';
            UIElements.paginationInfo.textContent = getTranslation('pagination_info', { current: state.productsPage, total: totalPages });
            UIElements.prevPageBtn.disabled = state.productsPage === 1;
            UIElements.nextPageBtn.disabled = state.productsPage === totalPages;
            const categories = await db.getAll('categories');
            UIElements.productsTableBody.innerHTML = paginatedProducts.map(p => {
                const category = categories.find(c => c.id === p.categoryId);
                return `
                    <tr>
                        <td>
                            <img src="${p.image || ''}" class="product-table-image" alt="Menu Item" data-id="${p.id}" onerror="this.style.display='none'; this.nextSibling.style.display='inline-block'">
                            <i class="fas fa-utensils" style="display:none; font-size: 24px; color: var(--border-color);"></i>
                        </td>
                        <td>${p.name}</td>
                        <td>${category ? category.name : getTranslation('label_uncategorized')}</td>
                        <td>${formatCurrency(p.price)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary" data-action="edit-product" data-id="${p.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger" data-action="delete-product" data-id="${p.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
    }

    async function renderCategoriesPage() {
        const [allCategories, products] = await Promise.all([db.getAll('categories'), db.getAll('products')]);
        const tableBody = UIElements.categoriesTableBody;
        const totalPages = Math.ceil(allCategories.length / state.categoriesPerPage) || 1;
        state.categoriesPage = Math.min(state.categoriesPage, totalPages);
        const startIndex = (state.categoriesPage - 1) * state.categoriesPerPage;
        const endIndex = startIndex + state.categoriesPerPage;
        const paginatedCategories = allCategories.slice(startIndex, endIndex);

        if (allCategories.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="3"><div class="empty-state"><i class="fas fa-tags"></i><p>${getTranslation('empty_no_categories')}</p></div></td></tr>`;
            UIElements.categoriesPagination.style.display = 'none';
            return;
        }

        UIElements.categoriesPagination.style.display = 'flex';
        UIElements.categoryPaginationInfo.textContent = getTranslation('pagination_info', { current: state.categoriesPage, total: totalPages });
        UIElements.prevCategoryPageBtn.disabled = state.categoriesPage === 1;
        UIElements.nextCategoryPageBtn.disabled = state.categoriesPage === totalPages;
        tableBody.innerHTML = paginatedCategories.map(c => {
            const productCount = products.filter(p => p.categoryId === c.id).length;
            return `
                <tr>
                    <td>${c.name}</td>
                    <td>${productCount}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-outline-primary" data-action="edit-category" data-id="${c.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" data-action="delete-category" data-id="${c.id}"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // --- Orders Page Logic ---
    async function renderOrdersPage() {
        if (state.activeTableOrParcelId) {
            UIElements.tableParcelSelectorContainer.style.display = 'none';
            UIElements.addItemsContainer.style.display = 'block';
            await renderProductsGridForOrder();
            renderCurrentOrder();
        } else {
            UIElements.tableParcelSelectorContainer.style.display = 'block';
            UIElements.addItemsContainer.style.display = 'none';
            renderTableParcelSelector();
            renderCurrentOrder(); // Renders the empty state for the order details
        }
    }

    function renderTableParcelSelector() {
        UIElements.tablesGrid.innerHTML = '';
        UIElements.parcelsGrid.innerHTML = '';

        const activeOrderIds = Object.keys(state.activeOrders);

        for (let i = 1; i <= 25; i++) {
            const id = `T${i}`;
            const btn = document.createElement('button');
            btn.className = 'btn selector-btn';
            btn.dataset.id = id;
            btn.textContent = id;
            if (activeOrderIds.includes(id)) {
                btn.classList.add('has-order');
            }
            UIElements.tablesGrid.appendChild(btn);
        }
        for (let i = 1; i <= 10; i++) {
            const id = `P${i}`;
            const btn = document.createElement('button');
            btn.className = 'btn selector-btn';
            btn.dataset.id = id;
            btn.textContent = id;
             if (activeOrderIds.includes(id)) {
                btn.classList.add('has-order');
            }
            UIElements.parcelsGrid.appendChild(btn);
        }
    }

    async function renderProductsGridForOrder(categoryId = 'all') {
        const categories = await db.getAll('categories');
        UIElements.categoryTabs.innerHTML = `<button class="category-tab active" data-id="all">${getTranslation('filter_all')}</button>` + 
            categories.map(c => `<button class="category-tab" data-id="${c.id}">${c.name}</button>`).join('');
        
        await renderProductCards(categoryId);
    }
    
    async function renderProductCards(categoryId) {
        document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
        const activeTab = document.querySelector(`.category-tab[data-id="${categoryId}"]`);
        if(activeTab) activeTab.classList.add('active');
        
        const products = await db.getAll('products');
        const productsToShow = (categoryId === 'all') ? products : products.filter(p => p.categoryId === categoryId);
        if (productsToShow.length === 0) {
            UIElements.productsGrid.innerHTML = `<div class="empty-state"><i class="fas fa-utensils"></i><p>${getTranslation('empty_no_menu_items_in_category')}</p></div>`;
            return;
        }
        UIElements.productsGrid.innerHTML = productsToShow.map((p, index) => `
                <div class="product-card" data-id="${p.id}">
                    <div class="product-image">
                        ${p.image ? `<img src="${p.image}" alt="${p.name}">` : '<i class="fas fa-hamburger"></i>'}
                    </div>
                    <div class="product-details">
                        <div class="product-name">${p.name}</div>
                        <div class="product-price">${formatCurrency(p.price)}</div>
                    </div>
                </div>
            `).join('');
    }

    function renderCurrentOrder() {
        const order = state.activeTableOrParcelId ? state.activeOrders[state.activeTableOrParcelId] : null;
        UIElements.orderTaxLabel.textContent = getTranslation('label_tax_rate_value', { rate: state.taxRate });
        
        if (!order) {
            UIElements.currentOrderId.textContent = '-';
            UIElements.orderItemsList.innerHTML = `<tr><td colspan="5"><div class="empty-state" style="padding:10px;"><p style="font-size:0.8rem; margin:0;">${getTranslation('empty_select_table_or_parcel')}</p></div></td></tr>`;
            UIElements.orderSubtotal.textContent = formatCurrency(0);
            UIElements.orderDiscountInput.value = 0;
            UIElements.orderNote.value = '';
            UIElements.orderTax.textContent = formatCurrency(0);
            UIElements.orderTotal.textContent = formatCurrency(0);
            UIElements.cancelOrderBtn.disabled = true;
            UIElements.sendOrderBtn.disabled = true;
            return;
        }

        UIElements.currentOrderId.textContent = order.tableOrParcelId;
        UIElements.orderItemsList.innerHTML = order.items.length > 0 ? order.items.map(item => `
            <tr class="${item.served ? 'item-served' : ''}">
                <td>${item.name}</td>
                <td>
                    <button class="btn btn-sm btn-secondary" data-action="decrease-qty" data-id="${item.productId}">-</button>
                    <span style="display: inline-block; width: 25px; text-align: center;">${item.quantity}</span>
                    <button class="btn btn-sm btn-secondary" data-action="increase-qty" data-id="${item.productId}">+</button>
                </td>
                <td>${formatCurrency(item.price)}</td>
                <td>${formatCurrency(item.price * item.quantity)}</td>
                <td style="text-align:center;">
                    <input type="checkbox" class="served-checkbox" data-product-id="${item.productId}" ${item.served ? 'checked' : ''}>
                </td>
            </tr>
        `).join('') : `<tr><td colspan="5"><div class="empty-state" style="padding:10px;"><p style="font-size:0.8rem; margin:0;">${getTranslation('empty_no_items_added')}</p></div></td></tr>`;

        UIElements.orderNote.value = order.note || '';

        const subtotal = order.items.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const discount = parseFloat(UIElements.orderDiscountInput.value) || 0;
        const taxableAmount = subtotal - discount;
        const tax = taxableAmount > 0 ? taxableAmount * (state.taxRate / 100) : 0;
        const total = taxableAmount + tax;
        
        order.subtotal = subtotal;
        order.discount = discount;
        order.tax = tax;
        order.total = total;

        UIElements.orderSubtotal.textContent = formatCurrency(subtotal);
        UIElements.orderDiscountInput.value = discount;
        UIElements.orderTax.textContent = formatCurrency(tax);
        UIElements.orderTotal.textContent = formatCurrency(total);
        const hasItems = order.items.length > 0;
        UIElements.sendOrderBtn.disabled = !hasItems;
        UIElements.cancelOrderBtn.disabled = false;
    }
    
    async function renderKitchenPage() {
        const activeOrders = Object.values(state.activeOrders);
        activeOrders.sort((a, b) => a.id.localeCompare(b.id)); // Sort by creation time

        if (activeOrders.length === 0) {
            UIElements.kitchenOrdersGrid.innerHTML = `<div class="empty-state" style="grid-column: 1 / -1;"><i class="fas fa-coffee"></i><p>${getTranslation('empty_no_active_orders')}</p></div>`;
            return;
        }

        UIElements.kitchenOrdersGrid.innerHTML = activeOrders.map((order, index) => {
            const addOnHtml = order.addOnCount > 0 ? `<span class="addon-indicator">Add-on x ${order.addOnCount}</span>` : '';
            return `
            <div class="kitchen-order-card">
                <h3>
                    <span>${order.tableOrParcelId} ${addOnHtml}</span>
                    <span class="order-number">#${index + 1}</span>
                </h3>
                <ul>
                    ${order.items.map(item => `
                        <li>
                            <span class="item-name">${item.name}</span>
                            <span class="item-qty">x ${item.quantity}</span>
                        </li>
                    `).join('')}
                </ul>
                ${order.note ? `<div class="order-note"><strong>Note:</strong>${order.note}</div>` : ''}
            </div>
        `}).join('');
    }

    async function renderPurchasesPage() {
        const tableBody = document.getElementById('purchases-table');
        let allPurchases = await db.getAll('purchases');
        let filteredPurchases = allPurchases;
        const filterType = document.querySelector('input[name="purchase-filter-type"]:checked').value;

        if (filterType === 'date') {
            const date = UIElements.purchaseFilterDate.value;
            if (date) filteredPurchases = allPurchases.filter(p => p.dateTime.startsWith(date));
        } else if (filterType === 'month') {
            const month = UIElements.purchaseFilterMonth.value;
            const year = UIElements.purchaseFilterYear.value;
            if (month && year) {
                const filterPrefix = `${year}-${month.toString().padStart(2, '0')}`;
                filteredPurchases = allPurchases.filter(p => p.dateTime.startsWith(filterPrefix));
            }
        }

        if (filteredPurchases.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><i class="fas fa-shopping-cart"></i><p>${getTranslation('empty_no_purchases_for_filter')}</p></div></td></tr>`;
            return;
        }
        
        filteredPurchases.sort((a,b) => new Date(b.dateTime) - new Date(a.dateTime));
        tableBody.innerHTML = filteredPurchases.map(p => `
                <tr>
                    <td>${p.productName}</td>
                    <td>${p.quantity}</td>
                    <td>${formatCurrency(p.totalCost)}</td>
                    <td>${new Date(p.dateTime).toLocaleString()}</td>
                    <td style="text-align:center;">
                        <input type="checkbox" class="received-checkbox" data-id="${p.id}" ${p.received ? 'checked' : ''}>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-danger" data-action="delete-purchase" data-id="${p.id}"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>`).join('');
    }
    
    async function renderSettingsPage() {
        const [taxRate, receiptTitle, language] = await Promise.all([
            db.get('settings', 'taxRate'),
            db.get('settings', 'receiptTitle'),
            db.get('settings', 'language')
        ]);
        UIElements.taxRateSetting.value = taxRate ? taxRate.value : 0;
        UIElements.receiptTitleSetting.value = receiptTitle ? receiptTitle.value : 'My Restaurant';
        UIElements.languageSelect.value = language ? language.value : 'mm';
    }
    
    async function populateFilterDropdowns() {
        const categories = await db.getAll('categories');
        const optionsHtml = `<option value="all" data-translate="filter_all_categories">${getTranslation('filter_all_categories')}</option>` + 
                            categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        const currentProductFilter = UIElements.productCategoryFilter.value;
        UIElements.productCategoryFilter.innerHTML = optionsHtml;
        UIElements.productCategoryFilter.value = currentProductFilter;
    }

    function populateDynamicFilters() {
        const currentYear = new Date().getFullYear();
        const yearOptions = [];
        for (let i = currentYear + 1; i >= 2023; i--) yearOptions.push(`<option value="${i}" ${i === currentYear ? 'selected' : ''}>${i}</option>`);
        const monthNames = getTranslation('month_names');
        const monthOptions = monthNames.map((name, index) => `<option value="${index + 1}">${name}</option>`).join('');
        UIElements.purchaseFilterYear.innerHTML = yearOptions.join('');
        UIElements.purchaseFilterMonth.innerHTML = monthOptions;
        UIElements.purchaseFilterDate.valueAsDate = new Date();
    }

    // ---------------------------------------------------------------------------
    //  4. Helper Functions (Theme, Formatting, Modals etc.)
    // ---------------------------------------------------------------------------

    function openModal(modalId) { document.getElementById(modalId).classList.add('show'); }
    function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }
    
    function triggerNotification(title, options) {
        notificationSound.play().catch(e => console.error("Audio playback failed:", e));
        if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);
        if ('Notification' in window && Notification.permission === 'granted') new Notification(title, options);
    }
    
    function showConfirmation({ title, message, onConfirm, okText = 'btn_confirm', isDanger = true }) {
        const modal = document.getElementById('confirm-modal');
        modal.querySelector('#confirm-modal-title').textContent = title;
        modal.querySelector('#confirm-message').textContent = message;
        const okBtn = modal.querySelector('#confirm-ok-btn');
        okBtn.innerHTML = `<span data-translate="${okText}">${getTranslation(okText)}</span>`;
        okBtn.className = `btn ${isDanger ? 'btn-danger' : 'btn-primary'}`;
        openModal('confirm-modal');
        const newOkBtn = okBtn.cloneNode(true);
        okBtn.parentNode.replaceChild(newOkBtn, okBtn);
        newOkBtn.addEventListener('click', () => {
             onConfirm();
        });
    }

    async function toggleTheme() {
        const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
        await db.put('settings', { key: 'theme', value: newTheme });
        applyTheme();
    }
    
    async function applyTheme() {
        const themeSetting = await db.get('settings', 'theme');
        const theme = themeSetting ? themeSetting.value : 'dark';
        document.body.className = `${theme}-mode`;
        UIElements.themeToggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    function formatCurrency(amount) { 
        const lang = state.currentLanguage;
        if (lang === 'jp') return new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(amount);
        return new Intl.NumberFormat('en-US').format(amount) + ' ကျပ်';
    }

    // ---------------------------------------------------------------------------
    //  5. Language & Translation (RESTAURANT-SPECIFIC)
    // ---------------------------------------------------------------------------
    const translations = {
        app_title: { en: "Restaurant POS", mm: "စားသောက်ဆိုင် POS", jp: "レストランPOS" },
        menu_menu_items: { en: "Menu Items", mm: "အစားအစာစာရင်း", jp: "メニュー項目" },
        menu_categories: { en: "Categories", mm: "အမျိုးအစားများ", jp: "カテゴリー" },
        menu_data_sync: { en: "Data Sync", mm: "ဒေတာ Sync", jp: "データ同期"},
        btn_add_menu_item: { en: "Add Menu Item", mm: "အစားအစာထည့်ရန်", jp: "メニュー項目を追加" },
        btn_add_category: { en: "Add Category", mm: "အမျိုးအစားထည့်ရန်", jp: "カテゴリーを追加" },
        label_menu_item_name: { en: "Menu Item Name", mm: "အစားအစာအမည်", jp: "メニュー項目名" },
        label_category: { en: "Category", mm: "အမျိုးအစား", jp: "カテゴリー" },
        label_price: { en: "Price", mm: "ဈေးနှုန်း", jp: "価格"},
        table_price: { en: "Price", mm: "ဈေးနှုန်း", jp: "価格" },
        label_item_image: { en: "Item Image", mm: "အစားအစာပုံ", jp: "項目の画像" },
        label_category_name: { en: "Category Name", mm: "အမျိုးအစားအမည်", jp: "カテゴリー名" },
        label_item_ingredient: { en: "Item / Ingredient Name", mm: "ပစ္စည်း / ပါဝင်ပစ္စည်းအမည်", jp: "品目/材料名" },
        placeholder_search_menu_items: { en: "Search menu items...", mm: "အစားအစာများရှာရန်...", jp: "メニュー項目を検索..." },
        placeholder_select_category: { en: "Select Category", mm: "အမျိုးအစားရွေးပါ", jp: "カテゴリーを選択" },
        placeholder_select_category_first: { en: "Select Category First", mm: "ဦးစွာအမျိုးအစားရွေးပါ", jp: "まずカテゴリーを選択" },
        placeholder_select_item: { en: "Select an Item", mm: "ပစ္စည်းတစ်ခုရွေးပါ", jp: "項目を選択" },
        empty_no_menu_items_yet: { en: "No menu items exist yet. Add one to get started!", mm: "အစားအစာများ မရှိသေးပါ။ စတင်ရန် တစ်ခုထည့်ပါ။", jp: "メニュー項目がまだありません。追加して始めましょう！" },
        empty_no_menu_items_match: { en: "No menu items match your search.", mm: "သင်၏ရှာဖွေမှုနှင့် ကိုက်ညီသော အစားအစာမရှိပါ။", jp: "検索に一致するメニュー項目はありません。" },
        empty_no_categories: { en: "No categories found", mm: "အမျိုးအစားများမတွေ့ပါ", jp: "カテゴリーが見つかりません" },
        empty_no_menu_items_in_category: { en: "No items in this category", mm: "ဤအမျိုးအစားတွင် ပစ္စည်းမရှိပါ", jp: "このカテゴリーに項目はありません" },
        empty_select_item: { en: "Select an item to begin sale", mm: "အရောင်းစတင်ရန် ပစ္စည်းတစ်ခုရွေးပါ", jp: "販売を開始するには商品を選択してください" },
        empty_select_table_or_parcel: { en: "Select a Table or Parcel to start an order.", mm: "Order စတင်ရန် စားပွဲ သို့မဟုတ် ပါဆယ်တစ်ခုကို ရွေးပါ။", jp: "注文を開始するにはテーブルまたは小包を選択してください。" },
        table_item_ingredient: { en: "Item/Ingredient Name", mm: "ပစ္စည်း/ပါဝင်ပစ္စည်းအမည်", jp: "品目/材料名" },
        table_category: { en: "Category", mm: "အမျိုးအစား", jp: "カテゴリー" },
        table_item_count: { en: "Item Count", mm: "ပစ္စည်းအရေအတွက်", jp: "品目数" },
        alert_cannot_delete_category: { en: "Cannot delete category. It has {count} item(s) assigned to it.", mm: "ဤအမျိုးအစားကိုဖျက်၍မရပါ။ ပစ္စည်း {count} ခုတွင်အသုံးပြုနေပါသည်။", jp: "カテゴリーを削除できません。{count}個の項目が割り当てられています。" },
        entity_product: { en: "menu item", mm: "အစားအစာ", jp: "メニュー項目" },
        entity_category: { en: "category", mm: "အမျိုးအစား", jp: "カテゴリー" },
        activation_title: { en: "Activation Required", mm: "အသုံးပြုခွင့် လိုအပ်သည်", jp: "アクティベーションが必要です" },
        activation_prompt: { en: "Please enter today's activation code to continue.", mm: "ဆက်လက်အသုံးပြုရန် ယနေ့အတွက် အသုံးပြုခွင့်ကုဒ်ကို ထည့်ပါ။", jp: "続行するには、今日のアクティベーションコードを入力してください。" },
        btn_activate: { en: "Activate", mm: "အသုံးပြုမည်", jp: "有効化" },
        menu_main: { en: "Main", mm: "ပင်မ", jp: "メイン" },
        menu_current_orders: { en: "POS Terminal", mm: "အရောင်းဂိတ်", jp: "POS端末" },
        menu_kitchen: { en: "Kitchen", mm: "မီးဖိုဆောင်", jp: "キッチン" },
        menu_management: { en: "Management", mm: "စီမံခန့်ခွဲမှု", jp: "管理" },
        menu_purchases: { en: "Ingredient Purchases", mm: "အဝယ်စာရင်း", jp: "仕入れ" },
        menu_settings: { en: "Settings", mm: "ဆက်တင်များ", jp: "設定" },
        menu_about: { en: "About", mm: "အချက်အလက်", jp: "概要" },
        label_order: { en: "Order for", mm: "Order for", jp: "注文" },
        label_order_note: { en: "Order Note", mm: "Order မှတ်စု", jp: "注文メモ"},
        placeholder_order_note: { en: "Add a note for the kitchen...", mm: "မီးဖိုဆောင်အတွက် မှတ်စုထည့်ပါ...", jp: "キッチンへのメモを追加..."},
        label_subtotal: { en: "Subtotal", mm: "စုစုပေါင်း", jp: "小計" },
        label_discount: { en: "Discount", mm: "လျှော့ဈေး", jp: "割引" },
        label_tax_rate_value: { en: "Tax ({rate}%)", mm: "အခွန် ({rate}%)", jp: "税金 ({rate}%)" },
        label_grand_total: { en: "Grand Total", mm: "ကျသင့်ငွေ", jp: "合計金額" },
        table_image: { en: "Image", mm: "ပုံ", jp: "画像" },
        table_name: { en: "Name", mm: "အမည်", jp: "名前" },
        table_actions: { en: "Actions", mm: "လုပ်ဆောင်ချက်", jp: "操作" },
        table_quantity: { en: "Quantity", mm: "အရေအတွက်", jp: "数量" },
        label_total_cost: { en: "Total Cost", mm: "စုစုပေါင်းကုန်ကျစရိတ်", jp: "総費用" },
        table_total_cost: { en: "Total Cost", mm: "စုစုပေါင်းကုန်ကျစရိတ်", jp: "総費用" },
        table_date: { en: "Date & Time", mm: "ရက်စွဲနှင့်အချိန်", jp: "日時" },
        table_received_status: { en: "Received", mm: "လက်ခံရရှိ", jp: "受領済み" },
        label_tax_rate: { en: "Tax Rate (%)", mm: "အခွန်နှုန်း (%)", jp: "税率 (%)" },
        label_receipt_title: { en: "Receipt Title", mm: "ဘောင်ချာခေါင်းစဉ်", jp: "レシートのタイトル" },
        label_language: { en: "Language", mm: "ဘာသာစကား", jp: "言語" },
        about_title: { en: "Restaurant POS System", mm: "စားသောက်ဆိုင် POS", jp: "レストランPOSシステム" },
        about_version: { en: "Version Lite 1.0", mm: "ဗားရှင်း Lite ၁.၀", jp: "バージョン Lite 1.0" },
        about_description: { en: "This is a modern Point of Sale system designed for restaurants. It provides features for order management, inventory tracking, and sales reporting.", mm: "ဤ POS စနစ်သည် စားသောက်ဆိုင်များအတွက် ရည်ရွယ်၍ ခေတ်မီစွာရေးဆွဲထားပါသည်။ Order, ကုန်ပစ္စည်း, နှင့် အရောင်းအစီရင်ခံစာများကို ကျယ်ပြန့်စွာ စီမံခန့်ခွဲနိုင်ပါသည်။", jp: "これはレストラン向けに設計された最新のPOSシステムです。注文管理、在庫追跡、販売レポートなどの機能を提供します。" },
        about_features_title: { en: "Features", mm: "အင်္ဂါရပ်များ", jp: "特徴" },
        about_features_list: {
            en: `<li>POS terminal with Table & Parcel management</li><li>Live Kitchen display with order sorting and notes</li><li>Menu item and category management with image support</li><li>Ingredient purchase tracking</li><li>Multi-device peer-to-peer data/order synchronization</li><li>Customizable settings and multi-language support</li>`,
            mm: `<li>စားပွဲနှင့် ပါဆယ်စီမံခန့်ခွဲမှုပါဝင်သော POS Terminal</li><li>Order စီစစ်ခြင်းနှင့် မှတ်စုများပါဝင်သော Kitchen Display</li><li>ပုံများထောက်ပံ့ပေးထားသော အစားအစာနှင့် အမျိုးအစား စီမံခန့်ခွဲမှု</li><li>ကုန်ကြမ်းဝယ်ယူမှု ခြေရာခံခြင်း</li><li>စက်အများအချင်းချင်း ဒေတာနှင့် Order များပို့နိုင်သောစနစ်</li><li>စိတ်ကြိုက်ပြင်ဆင်နိုင်သော ဆက်တင်များနှင့် ဘာသာစကားမျိုးစုံ ထောက်ပံ့မှု</li>`,
            jp: `<li>テーブル＆パーセル管理付きPOS端末</li><li>注文の並べ替えとメモ付きのライブキッチンディスプレイ</li><li>画像対応のメニュー項目・カテゴリ管理</li><li>食材の購入追跡</li><li>複数デバイス間のP2Pデータ/注文同期のため</li><li>カスタマイズ可能な設定と多言語対応</li>`,
        },
        about_developer_title: { en: "Developer", mm: "ရေးဆွဲသူ", jp: "開発者" },
        modal_add_menu_item_title: { en: "Add Menu Item", mm: "အစားအစာအသစ်ထည့်ရန်", jp: "メニュー項目の追加" },
        modal_edit_menu_item_title: { en: "Edit Menu Item", mm: "အစားအစာပြင်ရန်", jp: "メニュー項目の編集" },
        modal_add_category_title: { en: "Add Category", mm: "အမျိုးအစားသစ်ထည့်ရန်", jp: "カテゴリーの追加" },
        modal_edit_category_title: { en: "Edit Category", mm: "အမျိုးအစားပြင်ရန်", jp: "カテゴリーの編集" },
        modal_add_purchase_title: { en: "Add Ingredient Purchase", mm: "ကုန်ကြမ်းအဝယ်ထည့်ရန်", jp: "材料の仕入れを追加" },
        modal_confirm_delete_title: { en: "Confirm Deletion", mm: "ဖျက်ရန်အတည်ပြုပါ", jp: "削除の確認" },
        title_connection: { en: "Connection", mm: "ချိတ်ဆက်မှု", jp: "接続"},
        title_data_transfer: { en: "Data Transfer", mm: "ဒေတာလွှဲပြောင်းခြင်း", jp: "データ転送"},
        label_quantity: { en: "Quantity", mm: "အရေအတွက်", jp: "数量" },
        label_unit_cost: { en: "Unit Cost", mm: "တစ်ခုချင်းကုန်ကျစရိတ်", jp: "単価" },
        label_date_time: { en: "Date & Time", mm: "ရက်စွဲနှင့်အချိန်", jp: "日時" },
        label_your_peer_id: { en: "Your Peer ID", mm: "သင်၏ Peer ID", jp: "あなたのPeer ID"},
        label_connect_to_peer: { en: "Connect to Peer ID", mm: "Peer ID သို့ချိတ်ဆက်ရန်", jp: "Peer IDに接続"},
        btn_add_purchase: { en: "Add Purchase", mm: "အဝယ်ထည့်ရန်", jp: "仕入追加" },
        btn_cancel: { en: "Cancel", mm: "မလုပ်တော့ပါ", jp: "キャンセル" },
        btn_confirm: { en: "Confirm", mm: "အတည်ပြုသည်", jp: "確認" },
        btn_save_settings: { en: "Save Settings", mm: "ဆက်တင်များသိမ်းမည်", jp: "設定を保存" },
        btn_delete: { en: "Delete", mm: "ဖျက်မည်", jp: "削除" },
        btn_save_item: { en: "Save Item", mm: "ပစ္စည်းသိမ်းမည်", jp: "項目を保存" },
        btn_save: { en: "Save", mm: "သိမ်းမည်", jp: "保存" },
        btn_save_purchase: { en: "Save Purchase", mm: "အဝယ်သိမ်းမည်", jp: "仕入を保存" },
        btn_close: { en: "Close", mm: "ပိတ်မည်", jp: "閉じる" },
        btn_connect: { en: "Connect", mm: "ချိတ်ဆက်မည်", jp: "接続"},
        btn_send_order: { en: "Send", mm: "ပို့မည်", jp: "送信" },
        btn_send_menu_data: { en: "Send Menu Data", mm: "Menu ဒေတာပို့မည်", jp: "メニューデータを送信"},
        btn_send_all_orders: { en: "Send All Active Orders", mm: "Order အားလုံးပို့မည်", jp: "全アクティブ注文を送信"},
        btn_send_purchases: { en: "Send Purchases Data", mm: "အဝယ်ဒေတာပို့မည်", jp: "仕入データを送信"},
        empty_no_items_added: { en: "No items added", mm: "ပစ္စည်းမထည့်ရသေးပါ", jp: "商品が追加されていません" },
        confirm_cancel_order_title: { en: "Cancel Sale", mm: "အရောင်းပယ်ဖျက်ရန်", jp: "販売をキャンセル" },
        confirm_cancel_order_msg: { en: "Are you sure you want to clear this order?", mm: "ဤ Order ကိုရှင်းလင်းမှာလား?", jp: "この注文をクリアしてもよろしいですか？" },
        alert_fill_all_fields: { en: "Please fill all required fields.", mm: "လိုအပ်သောကွက်လပ်အားလုံးကို ဖြည့်စွက်ပေးပါ။", jp: "必須項目をすべて入力してください。" },
        alert_enter_category_name: { en: "Please enter a category name.", mm: "အမျိုးအစားအမည်ကို ထည့်ပေးပါ။", jp: "カテゴリー名を入力してください。" },
        alert_save_category_fail: { en: "Failed to save category.", mm: "အမျိုးအစားသိမ်းဆည်းရန် မအောင်မြင်ပါ။", jp: "カテゴリーの保存に失敗しました。" },
        alert_invalid_tax_rate: { en: "Please enter a valid, non-negative tax rate.", mm: "မှန်ကန်သော အခွန်နှုန်းထည့်ပါ။", jp: "有効な税率を入力してください。" },
        alert_empty_receipt_title: { en: "Receipt title cannot be empty.", mm: "ဘောင်ချာခေါင်းစဉ်အလွတ်မဖြစ်ရပါ။", jp: "レシートのタイトルは空にできません。" },
        alert_settings_saved: { en: "Settings saved successfully!", mm: "ဆက်တင်များအောင်မြင်စွာသိမ်းလိုက်ပါပြီ။", jp: "設定が正常に保存されました！" },
        alert_settings_save_fail: { en: "Failed to save settings.", mm: "ဆက်တင်များသိမ်းရန်မအောင်မြင်ပါ။", jp: "設定の保存に失敗しました。" },
        alert_peer_connected: { en: "Connected to peer!", mm: "Peer နှင့်ချိတ်ဆက်ပြီးပါပြီ!", jp: "ピアに接続しました！"},
        alert_peer_disconnected: { en: "Disconnected from peer.", mm: "Peer နှင့်အဆက်အသွယ်ပြတ်သွားပါပြီ။", jp: "ピアから切断されました。"},
        alert_connection_failed: { en: "Connection failed. Please check the Peer ID.", mm: "ချိတ်ဆက်မှုမအောင်မြင်ပါ။ Peer ID ကိုစစ်ဆေးပါ။", jp: "接続に失敗しました。Peer IDを確認してください。"},
        alert_data_sent: { en: "{dataType} data sent successfully.", mm: "{dataType} ဒေတာကိုအောင်မြင်စွာပို့လိုက်ပါပြီ။", jp: "{dataType}データを正常に送信しました。"},
        alert_data_received: { en: "Received {dataType} data from peer.", mm: "Peer ထံမှ {dataType} ဒေတာကိုလက်ခံရရှိပါသည်။", jp: "ピアから{dataType}データを受信しました。"},
        alert_order_received: { en: "Order for {tableId} has been updated.", mm: "{tableId} အတွက် Order ကို update လုပ်ပြီးပါပြီ။", jp: "注文 {tableId} が更新されました。" },
        alert_kitchen_update: { en: "New kitchen order update received!", mm: "မီးဖိုဆောင်အတွက် Order အသစ်ရောက်ပါပြီ။", jp: "新しいキッチン注文の更新を受信しました！" },
        alert_no_connection: { en: "Not connected to any peer.", mm: "ဘယ် Peer နှင့်မှချိတ်ဆက်မထားပါ။", jp: "どのピアにも接続されていません。"},
        confirm_delete_item_title: { en: "Confirm Deletion", mm: "ဖျက်ရန်အတည်ပြုပါ", jp: "削除の確認" },
        confirm_delete_item_msg: { en: "Are you sure you want to delete this {type}? This action cannot be undone.", mm: "ဤ {type} ကိုဖျက်မှာသေချာလား? ဤလုပ်ဆောင်ချက်ကိုပြန်ပြင်၍မရပါ။", jp: "この{type}を削除してもよろしいですか？この操作は元に戻せません。" },
        entity_purchase: { en: "purchase record", mm: "အဝယ်မှတ်တမ်း", jp: "仕入れ記録" },
        alert_delete_fail: { en: "Failed to delete item.", mm: "ဖျက်ရန်မအောင်မြင်ပါ။", jp: "アイテムの削除に失敗しました。" },
        filter_all_categories: { en: "All Categories", mm: "အမျိုးအစားအားလုံး", jp: "すべてのカテゴリー" },
        filter_all: { en: "All", mm: "အားလုံး", jp: "すべて" },
        filter_by_date: { en: "By Date", mm: "ရက်စွဲအလိုက်", jp: "日付別" },
        filter_by_month: { en: "By Month", mm: "လအလိုက်", jp: "月別" },
        label_filter_by: { en: "Filter by:", mm: "စစ်ထုတ်ရန်:", jp: "フィルター:" },
        label_date: { en: "Date:", mm: "ရက်စွဲ:", jp: "日付:" },
        label_month: { en: "Month:", mm: "လ:", jp: "月:" },
        label_year: { en: "Year:", mm: "နှစ်:", jp: "年:" },
        btn_apply_filter: { en: "Apply Filter", mm: "စစ်ထုတ်မည်", jp: "フィルター適用" },
        btn_clear_filter: { en: "Clear Filter", mm: "ပြန်စမည်", jp: "フィルター解除" },
        label_uncategorized: { en: "Uncategorized", mm: "အမျိုးအစားမခွဲထား", jp: "未分類" },
        table_item: { en: "Item", mm: "ပစ္စည်း", jp: "品目" },
        table_qty: { en: "Qty", mm: "အရေအတွက်", jp: "数量" },
        table_total: { en: "Total", mm: "စုစုပေါင်း", jp: "合計" },
        table_served: { en: "Served", mm: "ပို့ပြီး", jp: "提供済み" },
        label_total: { en: "Total", mm: "စုစုပေါင်း", jp: "合計" },
        empty_no_active_orders: { en: "No active orders in the kitchen.", mm: "မီးဖိုဆောင်တွင် လက်ရှိ Order မရှိပါ။", jp: "キッチンにアクティブな注文はありません。"},
        pagination_info: { en: "Page {current} of {total}", mm: "စာမျက်နှာ {total} ခုမှ {current}", jp: "{total}ページ中{current}ページ" },
        empty_no_purchases: { en: "No purchases found", mm: "ဝယ်ယူမှုများမတွေ့ပါ", jp: "購入が見つかりません" },
        empty_no_purchases_for_filter: { en: "No purchases found for the selected filter.", mm: "ရှာဖွေမှုနှင့်ကိုက်ညီသော အဝယ်စာရင်းမတွေ့ပါ။", jp: "選択したフィルターに該当する仕入れはありません。" },
        status_disconnected: { en: "Disconnected", mm: "အဆက်အသွယ်ပြတ်တောက်နေသည်", jp: "切断されました"},
        status_connecting: { en: "Connecting...", mm: "ချိတ်ဆက်နေသည်...", jp: "接続中..."},
        status_connected: { en: "Connected", mm: "ချိတ်ဆက်ပြီး", jp: "接続済み"},
        title_tables: { en: "Tables", mm: "စားပွဲများ", jp: "テーブル" },
        title_parcels: { en: "Parcels (Take Away)", mm: "ပါဆယ် (အိမ်ယူ)", jp: "持ち帰り" },
        btn_back: { en: "Back", mm: "နောက်သို့", jp: "戻る" },
        title_general_settings: { en: "General Settings", mm: "အထွေထွေ ဆက်တင်များ", jp: "一般設定"},
        kitchen_title: { en: "Kitchen Orders", mm: "မီးဖိုဆောင် Order များ", jp: "キッチン注文" },
        month_names: {
            en: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            mm: ["ဇန်နဝါရီ", "ဖေဖော်ဝါရီ", "မတ်", "ဧပြီ", "မေ", "ဇွန်", "ဇူလိုင်", "ဩဂုတ်", "စက်တင်ဘာ", "အောက်တိုဘာ", "နိုဝင်ဘာ", "ဒီဇင်ဘာ"],
            jp: ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"]
        }
    };

    function getTranslation(key, replacements = {}) {
        const lang = state.currentLanguage;
        let text = translations[key]?.[lang] || translations[key]?.['en'] || key;
        if (typeof text === 'string') {
            for (const placeholder in replacements) text = text.replace(new RegExp(`\\{${placeholder}\\}`, 'g'), replacements[placeholder]);
        }
        return text;
    }

    function translateUI(lang) {
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-translate]').forEach(el => {
            const key = el.dataset.translate;
            const translationType = el.dataset.translateType;
            const text = getTranslation(key);
            if (translationType === 'list') el.innerHTML = text;
            else if (['SPAN', 'P', 'H1', 'H2', 'H3', 'H4', 'LABEL', 'TH', 'A', 'BUTTON'].includes(el.tagName)) el.textContent = text;
            else el.innerHTML = text;
        });
        document.querySelectorAll('[data-translate-placeholder]').forEach(el => el.placeholder = getTranslation(el.dataset.translatePlaceholder));
    }

    async function setLanguage(lang) {
        state.currentLanguage = lang;
        UIElements.languageSelect.value = lang;
        await db.put('settings', { key: 'language', value: lang });
        await populateFilterDropdowns();
        populateDynamicFilters();
        await renderSettingsPage();
        translateUI(lang);
    }

    // ---------------------------------------------------------------------------
    //  6. Event Handlers & Business Logic
    // ---------------------------------------------------------------------------

    function setupEventListeners() {
        UIElements.sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const section = e.currentTarget.dataset.section;
                if(section) {
                    state.currentSection = section;
                    render();
                    if (window.innerWidth < 992) UIElements.sidebar.classList.remove('show');
                }
            });
        });

        UIElements.bottomNav.addEventListener('click', (e) => {
            const link = e.target.closest('.bottom-nav-link');
            if (link) {
                e.preventDefault();
                state.currentSection = link.dataset.section;
                render();
            }
        });

        UIElements.menuToggle.addEventListener('click', () => UIElements.sidebar.classList.toggle('show'));
        UIElements.themeToggle.addEventListener('click', toggleTheme);
        UIElements.languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));
        
        document.getElementById('add-new-product-btn').addEventListener('click', () => openProductModal());
        document.getElementById('add-new-category-btn').addEventListener('click', () => openCategoryModal());
        document.getElementById('add-new-purchase-btn').addEventListener('click', () => openPurchaseModal());
        
        UIElements.productsSearchInput.addEventListener('input', () => { state.productsPage = 1; renderMenuItemsPage(); });
        UIElements.productCategoryFilter.addEventListener('change', () => { state.productsPage = 1; renderMenuItemsPage(); });
        UIElements.prevPageBtn.addEventListener('click', () => { if(state.productsPage > 1) { state.productsPage--; renderMenuItemsPage(); } });
        UIElements.nextPageBtn.addEventListener('click', () => { state.productsPage++; renderMenuItemsPage(); });
        
        UIElements.prevCategoryPageBtn.addEventListener('click', () => { if(state.categoriesPage > 1) { state.categoriesPage--; renderCategoriesPage(); } });
        UIElements.nextCategoryPageBtn.addEventListener('click', () => { state.categoriesPage++; renderCategoriesPage(); });

        // POS Terminal event listeners
        UIElements.tableParcelSelectorContainer.addEventListener('click', e => {
            const btn = e.target.closest('.selector-btn');
            if (btn) handleTableParcelSelect(btn.dataset.id);
        });
        UIElements.backToSelectorBtn.addEventListener('click', () => {
            state.activeTableOrParcelId = null;
            renderOrdersPage();
        });
        UIElements.categoryTabs.addEventListener('click', e => { if (e.target.matches('.category-tab')) renderProductCards(e.target.dataset.id); });
        UIElements.productsGrid.addEventListener('click', e => { const card = e.target.closest('.product-card:not(.disabled)'); if (card) addProductToOrder(card.dataset.id); });
        
        UIElements.orderItemsList.addEventListener('click', e => {
            const button = e.target.closest('button');
            const checkbox = e.target.closest('.served-checkbox');

            if (button) {
                const action = button.dataset.action;
                if (action === 'increase-qty' || action === 'decrease-qty') {
                    updateOrderItemQuantity(button.dataset.id, action === 'increase-qty' ? 1 : -1);
                }
            } else if (checkbox) {
                handleItemServedToggle(checkbox.dataset.productId, checkbox.checked);
            }
        });
        
        UIElements.orderNote.addEventListener('input', async () => {
            if (state.activeTableOrParcelId && state.activeOrders[state.activeTableOrParcelId]) {
                state.activeOrders[state.activeTableOrParcelId].note = UIElements.orderNote.value;
                await saveActiveOrder(state.activeTableOrParcelId);
            }
        });
        
        UIElements.orderDiscountInput.addEventListener('input', async () => {
            renderCurrentOrder();
            await saveActiveOrder(state.activeTableOrParcelId);
        });

        UIElements.cancelOrderBtn.addEventListener('click', handleCancelOrder);
        UIElements.sendOrderBtn.addEventListener('click', handleSendOrder);
        
        UIElements.purchaseFilterType.addEventListener('change', (e) => {
            const type = e.target.value;
            UIElements.purchaseDateFilterGroup.style.display = type === 'date' ? 'flex' : 'none';
            UIElements.purchaseMonthFilterGroup.style.display = type === 'month' ? 'flex' : 'none';
        });
        document.getElementById('apply-purchase-filter-btn').addEventListener('click', renderPurchasesPage);
        document.getElementById('clear-purchase-filter-btn').addEventListener('click', () => {
            document.getElementById('filter-all-purchases').checked = true;
            UIElements.purchaseDateFilterGroup.style.display = 'none';
            UIElements.purchaseMonthFilterGroup.style.display = 'none';
            renderPurchasesPage();
        });

        // Event listener for the new "Received" checkbox in the purchases table
        document.getElementById('purchases-table').addEventListener('change', e => {
            if (e.target.matches('.received-checkbox')) {
                const purchaseId = e.target.dataset.id;
                const isReceived = e.target.checked;
                handlePurchaseReceivedToggle(purchaseId, isReceived);
            }
        });

        const purchaseQuantityInput = document.getElementById('purchase-quantity');
        const purchaseUnitCostInput = document.getElementById('purchase-unit-cost');
        const purchaseTotalCostInput = document.getElementById('purchase-total-cost');

        const updatePurchaseCosts = (changedInput) => {
            const qty = parseInt(purchaseQuantityInput.value);
            if (!qty || qty <= 0) return;

            if (changedInput === 'unit') {
                const unitCost = parseFloat(purchaseUnitCostInput.value);
                purchaseTotalCostInput.value = !isNaN(unitCost) ? (unitCost * qty).toFixed(2) : '';
            } else if (changedInput === 'total') {
                const totalCost = parseFloat(purchaseTotalCostInput.value);
                purchaseUnitCostInput.value = !isNaN(totalCost) ? (totalCost / qty).toFixed(2) : '';
            } else if (changedInput === 'qty') {
                const unitCost = parseFloat(purchaseUnitCostInput.value);
                if (!isNaN(unitCost)) {
                    purchaseTotalCostInput.value = (unitCost * qty).toFixed(2);
                }
            }
        };

        purchaseUnitCostInput.addEventListener('input', () => updatePurchaseCosts('unit'));
        purchaseTotalCostInput.addEventListener('input', () => updatePurchaseCosts('total'));
        purchaseQuantityInput.addEventListener('input', () => updatePurchaseCosts('qty'));

        document.getElementById('save-product-btn').addEventListener('click', handleSaveProduct);
        document.getElementById('save-category-btn').addEventListener('click', handleSaveCategory);
        document.getElementById('save-purchase-btn').addEventListener('click', handleSavePurchase);
        document.getElementById('save-settings-btn').addEventListener('click', handleSaveSettings);

        document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', (e) => closeModal(e.target.closest('.modal').id)));
        
        document.body.addEventListener('click', e => {
            const button = e.target.closest('button');
            const image = e.target.closest('.product-table-image');
            if (button) {
                const { action, id } = button.dataset;
                if (!action || !id) return;
                switch(action) {
                    case 'edit-product': openProductModal(id); break;
                    case 'delete-product': openDeleteModal(id, 'product'); break;
                    case 'edit-category': openCategoryModal(id); break;
                    case 'delete-category': openDeleteModal(id, 'category'); break;
                    case 'delete-purchase': openDeleteModal(id, 'purchase'); break;
                }
            }
            if (image) viewFullImage(image.src);
        });

        document.getElementById('confirm-cancel-btn').addEventListener('click', () => closeModal('confirm-modal'));
        document.getElementById('delete-product-btn').addEventListener('click', () => {
            const id = document.getElementById('product-id').value;
            if(id) openDeleteModal(id, 'product', true);
        });
        document.getElementById('delete-category-btn').addEventListener('click', () => {
            const id = document.getElementById('category-id').value;
            if(id) openDeleteModal(id, 'category', true);
        });

        const imageUpload = document.getElementById('product-image-upload');
        const imagePreview = document.getElementById('product-image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        imageUpload.addEventListener('change', () => {
            const file = imageUpload.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    removeImageBtn.style.display = 'inline-flex';
                };
                reader.readAsDataURL(file);
            }
        });
        removeImageBtn.addEventListener('click', () => {
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            removeImageBtn.style.display = 'none';
            imageUpload.value = '';
        });

        // Data Sync (WebRTC) Event Listeners
        setupDataSyncEventListeners();
    }

    // --- LOGIC FUNCTIONS ---
    
    async function saveActiveOrder(tableOrParcelId) {
        if (!tableOrParcelId || !state.activeOrders[tableOrParcelId]) return;
        try {
            await db.put('orders', state.activeOrders[tableOrParcelId]);
        } catch (error) {
            console.error(`Failed to sync order with database for ${tableOrParcelId}:`, error);
            showAlert('Failed to sync order with database.', 'danger');
        }
    }

    async function handleTableParcelSelect(id) {
        state.activeTableOrParcelId = id;
        if (!state.activeOrders[id]) {
            state.activeOrders[id] = {
                id: `ord-${Date.now()}`,
                tableOrParcelId: id,
                date: new Date().toISOString().slice(0, 10),
                status: 'active',
                items: [],
                note: '',
                subtotal: 0, 
                discount: 0,
                tax: 0, 
                total: 0,
                addOnCount: 0
            };
            await saveActiveOrder(id); // Save new active order to DB
        }
        UIElements.orderDiscountInput.value = state.activeOrders[id].discount || 0;
        renderOrdersPage();
    }
    
    async function addProductToOrder(productId) {
        if (!state.activeTableOrParcelId) return;
        const currentOrder = state.activeOrders[state.activeTableOrParcelId];
        
        const product = await db.get('products', productId);
        const existingItem = currentOrder.items.find(item => item.productId === productId);
        
        const orderCreationTime = parseInt(currentOrder.id.split('-')[1]);
        const isLateAddOn = (Date.now() - orderCreationTime) > 60000; // 1 minute threshold for add-on

        if (existingItem) {
            existingItem.quantity++;
        } else {
            currentOrder.items.push({ 
                productId: product.id, 
                name: product.name, 
                price: product.price, 
                quantity: 1,
                served: false
            });
        }
        
        if(currentOrder.items.length > 1 && isLateAddOn) {
            currentOrder.addOnCount = (currentOrder.addOnCount || 0) + 1;
        }

        renderCurrentOrder();
        await saveActiveOrder(state.activeTableOrParcelId);
    }
    
    async function updateOrderItemQuantity(productId, change) {
        if (!state.activeTableOrParcelId) return;
        const currentOrder = state.activeOrders[state.activeTableOrParcelId];
        const item = currentOrder.items.find(i => i.productId === productId);
        if (!item) return;
       
        item.quantity += change;

        if (change > 0) {
            const orderCreationTime = parseInt(currentOrder.id.split('-')[1]);
            const isLateAddOn = (Date.now() - orderCreationTime) > 60000; // 1 minute
            if (isLateAddOn) {
                currentOrder.addOnCount = (currentOrder.addOnCount || 0) + 1;
            }
        }

        if (item.quantity <= 0) {
            currentOrder.items = currentOrder.items.filter(i => i.productId !== productId);
        }
        renderCurrentOrder();
        await saveActiveOrder(state.activeTableOrParcelId);
    }

    async function handleItemServedToggle(productId, isServed) {
        if (!state.activeTableOrParcelId) return;
        const currentOrder = state.activeOrders[state.activeTableOrParcelId];
        const item = currentOrder.items.find(i => i.productId === productId);
        if (item) {
            item.served = isServed;
            renderCurrentOrder();
            await saveActiveOrder(state.activeTableOrParcelId);
        }
    }

    function handleCancelOrder() {
        if (!state.activeTableOrParcelId) return;
        showConfirmation({
            title: getTranslation('confirm_cancel_order_title'),
            message: getTranslation('confirm_cancel_order_msg'),
            onConfirm: async () => {
                const orderToCancel = state.activeOrders[state.activeTableOrParcelId];
                if (orderToCancel) {
                    await db.delete('orders', orderToCancel.id);
                }
                delete state.activeOrders[state.activeTableOrParcelId];
                state.activeTableOrParcelId = null;
                renderOrdersPage();
                await renderKitchenPage();
                closeModal('confirm-modal');
            }
        });
    }

    async function handleSendOrder() {
        if (!state.activeTableOrParcelId) return;
        const currentOrder = state.activeOrders[state.activeTableOrParcelId];
        await sendData('order_update', currentOrder);
        showAlert(getTranslation('alert_data_sent', {dataType: 'Order Update'}), 'success');
    }

    async function openProductModal(productId = null) {
        document.getElementById('product-form').reset();
        document.getElementById('product-image-preview').style.display = 'none';
        document.getElementById('remove-image-btn').style.display = 'none';
        const catSelect = document.getElementById('product-category');
        catSelect.innerHTML = `<option value="">${getTranslation('placeholder_select_category')}</option>` + 
            (await db.getAll('categories')).map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        const title = document.getElementById('product-modal-title');
        const delBtn = document.getElementById('delete-product-btn');
        const idInput = document.getElementById('product-id');

        if (productId) {
            const product = await db.get('products', productId);
            title.textContent = getTranslation('modal_edit_menu_item_title');
            delBtn.style.display = 'inline-flex';
            idInput.value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            catSelect.value = product.categoryId;
            if (product.image) {
                document.getElementById('product-image-preview').src = product.image;
                document.getElementById('product-image-preview').style.display = 'block';
                document.getElementById('remove-image-btn').style.display = 'inline-flex';
            }
        } else {
            title.textContent = getTranslation('modal_add_menu_item_title');
            delBtn.style.display = 'none';
            idInput.value = '';
        }
        openModal('product-modal');
    }

    async function handleSaveProduct() {
        const id = document.getElementById('product-id').value;
        const name = document.getElementById('product-name').value.trim();
        const price = parseFloat(document.getElementById('product-price').value);
        const categoryId = document.getElementById('product-category').value;
        const imageSrc = document.getElementById('product-image-preview').src;
        const imageFile = document.getElementById('product-image-upload').files[0];
        let imageBase64 = document.getElementById('product-image-preview').src.startsWith('data:image') ? document.getElementById('product-image-preview').src : null;
        
        if (!imageFile && id) {
            const existingProduct = await db.get('products', id);
            imageBase64 = existingProduct.image;
        }

        if (!name || isNaN(price) || !categoryId) { showAlert(getTranslation('alert_fill_all_fields'), 'danger'); return; }
        
        try {
            const productData = { name, price, categoryId, image: imageBase64 };
            if (id) {
                await db.put('products', { ...productData, id });
            } else {
                const newId = `food-${Date.now()}`;
                await db.add('products', { ...productData, id: newId });
            }
            await renderMenuItemsPage();
            closeModal('product-modal');
        } catch (error) { console.error('Error saving menu item:', error); }
    }
    
    async function openCategoryModal(categoryId = null) {
        document.getElementById('category-form').reset();
        const title = document.getElementById('category-modal-title');
        const delBtn = document.getElementById('delete-category-btn');
        const idInput = document.getElementById('category-id');

        if (categoryId) {
            const category = await db.get('categories', categoryId);
            title.textContent = getTranslation('modal_edit_category_title');
            delBtn.style.display = 'inline-flex';
            idInput.value = category.id;
            document.getElementById('category-name').value = category.name;
        } else {
            title.textContent = getTranslation('modal_add_category_title');
            delBtn.style.display = 'none';
            idInput.value = '';
        }
        openModal('category-modal');
    }

    async function handleSaveCategory() {
        const id = document.getElementById('category-id').value;
        const name = document.getElementById('category-name').value.trim();
        if (!name) { showAlert(getTranslation('alert_enter_category_name'), 'danger'); return; }
        try {
            if (id) await db.put('categories', { id, name });
            else await db.add('categories', { id: `cat-${Date.now()}`, name });
            await renderCategoriesPage();
            await populateFilterDropdowns();
            closeModal('category-modal');
        } catch (error) { showAlert(getTranslation('alert_save_category_fail'), 'danger'); }
    }

    async function openPurchaseModal() {
        document.getElementById('purchase-form').reset();
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('purchase-date').value = now.toISOString().slice(0, 16);
        openModal('purchase-modal');
    }

    async function handleSavePurchase() {
        const itemName = document.getElementById('purchase-item-name').value.trim();
        const quantity = parseInt(document.getElementById('purchase-quantity').value);
        const unitCost = parseFloat(document.getElementById('purchase-unit-cost').value);
        const dateTime = document.getElementById('purchase-date').value;
        if (!itemName || !quantity || isNaN(unitCost) || unitCost < 0 || !dateTime) { showAlert(getTranslation('alert_fill_all_fields'), 'danger'); return; }
        try {
            await db.add('purchases', { 
                id: `pch-${Date.now()}`, 
                productName: itemName, 
                quantity, 
                unitCost, 
                totalCost: quantity * unitCost, 
                dateTime,
                received: false // Default received status
            });
            await renderPurchasesPage();
            closeModal('purchase-modal');
        } catch (error) { console.error('Error saving purchase:', error); }
    }

    async function handlePurchaseReceivedToggle(purchaseId, isReceived) {
        try {
            const purchase = await db.get('purchases', purchaseId);
            if (purchase) {
                purchase.received = isReceived;
                await db.put('purchases', purchase);
                // Optional: show a confirmation alert
                // showAlert('Purchase status updated.', 'success');
            }
        } catch (error) {
            console.error('Failed to update purchase status:', error);
            showAlert('Failed to update status.', 'danger');
            // Re-render to revert the checkbox state on error
            renderPurchasesPage();
        }
    }
    
    async function handleSaveSettings() {
        const newTaxRate = parseFloat(UIElements.taxRateSetting.value);
        const newReceiptTitle = UIElements.receiptTitleSetting.value.trim();

        if (isNaN(newTaxRate) || newTaxRate < 0) { showAlert(getTranslation('alert_invalid_tax_rate'), 'danger'); return; }
        if (!newReceiptTitle) { showAlert(getTranslation('alert_empty_receipt_title'), 'danger'); return; }
        
        try {
            await Promise.all([
                db.put('settings', {key: 'taxRate', value: newTaxRate}),
                db.put('settings', {key: 'receiptTitle', value: newReceiptTitle})
            ]);
            state.taxRate = newTaxRate;
            showAlert(getTranslation('alert_settings_saved'));
        } catch (error) { showAlert(getTranslation('alert_settings_save_fail'), 'danger'); }
    }
    
    function viewFullImage(src) { if (src) { document.getElementById('full-size-image').src = src; openModal('image-viewer-modal'); } }

    function openDeleteModal(id, type, fromModal = false) {
        itemToDelete = { id, type, fromModal };
        const typeName = getTranslation(`entity_${type}`);
        showConfirmation({
            title: getTranslation('confirm_delete_item_title'),
            message: getTranslation('confirm_delete_item_msg', { type: typeName }),
            okText: 'btn_delete', onConfirm: handleDelete
        });
    }
    
    async function handleDelete() {
        if (!itemToDelete) return;
        const { id, type, fromModal } = itemToDelete;
        try {
            if (type === 'product') {
                await db.delete('products', id);
                await renderMenuItemsPage();
            } else if (type === 'category') {
                const productCount = await db.count('products', 'categoryId', IDBKeyRange.only(id));
                if (productCount > 0) {
                    showAlert(getTranslation('alert_cannot_delete_category', { count: productCount }), 'danger');
                    closeModal('confirm-modal'); return;
                }
                await db.delete('categories', id);
                await renderCategoriesPage();
                await populateFilterDropdowns();
            } else if (type === 'purchase') {
                await db.delete('purchases', id);
                await renderPurchasesPage();
            }
            closeModal('confirm-modal');
            if (fromModal) closeModal(`${type}-modal`);
        } catch (error) { showAlert(getTranslation('alert_delete_fail'), 'danger'); } 
        finally { itemToDelete = null; }
    }

    // ===========================================================================
    //  8. DATA SYNC (WebRTC) LOGIC - MULTI-DEVICE UPDATE
    // ===========================================================================
    let peer;
    let connections = {};

    function setupDataSyncEventListeners() {
        document.getElementById('connect-peer-btn').addEventListener('click', connectToPeer);
        document.getElementById('send-products-btn').addEventListener('click', () => sendData('products'));
        document.getElementById('send-all-orders-btn').addEventListener('click', () => sendData('all_orders', state.activeOrders));
        document.getElementById('send-purchases-btn').addEventListener('click', () => sendData('purchases'));
    }

    function renderDataSyncPage() {
        initializePeer();
    }

    function initializePeer() {
        if(peer) return;

        peer = new Peer();
        const myIdEl = document.getElementById('my-peer-id');
        
        peer.on('open', id => {
            myIdEl.value = id;
            logToSyncConsole(`My Peer ID is: ${id}`);
        });

        peer.on('connection', connection => {
            logToSyncConsole(`Incoming connection from ${connection.peer}`);
            connections[connection.peer] = connection;
            setupConnectionEvents(connection);
            updateConnectionUI();
        });

        peer.on('error', err => {
            console.error("PeerJS Error:", err);
            logToSyncConsole(`Error: ${err.type}`);
            updateConnectionUI();
        });
    }

    function connectToPeer() {
        const peerId = document.getElementById('peer-id-input').value.trim();
        if(!peerId || connections[peerId]) {
            showAlert('Please enter a valid, new Peer ID.', 'warning');
            return;
        }

        logToSyncConsole(`Attempting to connect to ${peerId}...`);
        
        const newConn = peer.connect(peerId);
        connections[peerId] = newConn;
        setupConnectionEvents(newConn);
    }
    
    function setupConnectionEvents(connection) {
        connection.on('open', () => {
            logToSyncConsole(`Connection established with ${connection.peer}`);
            showAlert(getTranslation('alert_peer_connected'));
            updateConnectionUI();
        });

        connection.on('data', data => {
            logToSyncConsole(`Received data of type: ${data.type} from ${connection.peer}`);
            handleReceivedData(data);
        });

        connection.on('close', () => {
            logToSyncConsole(`Connection with ${connection.peer} closed.`);
            showAlert(getTranslation('alert_peer_disconnected'), 'warning');
            delete connections[connection.peer];
            updateConnectionUI();
        });
        
        connection.on('error', (err) => {
            console.error('Connection Error with ' + connection.peer, err);
            logToSyncConsole(`Connection error with ${connection.peer}: ${err.type}`);
            showAlert(getTranslation('alert_connection_failed'), 'danger');
            delete connections[connection.peer];
            updateConnectionUI();
        });
    }

    function updateConnectionUI() {
        const peerCount = Object.keys(connections).length;
        document.getElementById('webrtc-peer-count').textContent = `(${peerCount} connected)`;
        const statusEl = document.getElementById('webrtc-status');
        
        if (peerCount > 0) {
            statusEl.className = 'webrtc-status connected';
            statusEl.textContent = getTranslation('status_connected');
        } else {
            statusEl.className = 'webrtc-status disconnected';
            statusEl.textContent = getTranslation('status_disconnected');
        }
    }

    function logToSyncConsole(message) {
        const logEl = document.getElementById('data-sync-log');
        const p = document.createElement('p');
        p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logEl.appendChild(p);
        logEl.scrollTop = logEl.scrollHeight;
    }

    async function sendData(dataType, customPayload = null) {
        const activeConnections = Object.values(connections).filter(c => c && c.open);

        if (activeConnections.length === 0) {
            showAlert(getTranslation('alert_no_connection'), 'danger');
            return;
        }
        
        if ('vibrate' in navigator) navigator.vibrate(100);

        let dataPayload = customPayload;
        if (!dataPayload) {
             dataPayload = await db.getAll(dataType);
        }
        
        const dataToSend = {
            type: dataType,
            payload: dataPayload
        };
        
        activeConnections.forEach(conn => {
            conn.send(dataToSend);
        });
        logToSyncConsole(`Sent ${dataType} data to ${activeConnections.length} peer(s).`);
    }

    async function handleReceivedData({type, payload}) {
        logToSyncConsole(`Processing data for ${type}...`);
        
        let notifTitle = 'Data Sync';
        let notifBody = `Received ${type} data from a peer.`;

        try {
            if (type === 'order_update') {
                const incomingOrder = payload;
                const existingOrder = state.activeOrders[incomingOrder.tableOrParcelId];
                if (!existingOrder || parseInt(incomingOrder.id.split('-')[1]) >= parseInt(existingOrder.id.split('-')[1])) {
                    state.activeOrders[incomingOrder.tableOrParcelId] = incomingOrder;
                    await db.put('orders', incomingOrder);
                    
                    notifTitle = 'Kitchen Update!';
                    notifBody = `Order for ${payload.tableOrParcelId} has been updated.`;
                    showAlert(getTranslation('alert_order_received', { tableId: payload.tableOrParcelId }), 'success');

                    if(state.currentSection === 'orders') {
                        renderTableParcelSelector(); 
                        if (state.activeTableOrParcelId === incomingOrder.tableOrParcelId) {
                            renderCurrentOrder();
                        }
                    }
                    if(state.currentSection === 'kitchen') await renderKitchenPage();
                }

            } else if (type === 'order_completed') {
                const { tableOrParcelId } = payload;
                if (state.activeOrders[tableOrParcelId]) {
                    delete state.activeOrders[tableOrParcelId];
                    
                    notifTitle = 'Order Completed';
                    notifBody = `Order for ${tableOrParcelId} was completed on another device.`;
                    showAlert(notifBody, 'success');

                    if (state.currentSection === 'orders' && state.activeTableOrParcelId === tableOrParcelId) {
                        state.activeTableOrParcelId = null;
                        await renderOrdersPage();
                    } else if (state.currentSection === 'orders') {
                        renderTableParcelSelector(); 
                    }
                    
                    if(state.currentSection === 'kitchen') await renderKitchenPage();
                }

            } else if (type === 'all_orders') {
                state.activeOrders = payload; // Fully replace active orders state
                const allActiveOrders = Object.values(payload);
                const tx = dbInstance.transaction('orders', 'readwrite');
                const store = tx.objectStore('orders');
                
                const oldActiveOrders = await db.getAll('orders', 'status', IDBKeyRange.only('active'));
                oldActiveOrders.forEach(o => store.delete(o.id));
                allActiveOrders.forEach(o => store.put(o));
                
                await new Promise((res, rej) => { tx.oncomplete = res; tx.onerror = rej; });

                notifTitle = 'Orders Synced';
                notifBody = `Received all active orders from a peer.`;
                showAlert(notifBody, 'success');
                
                if (['orders', 'kitchen'].includes(state.currentSection)) {
                    await render();
                }

            } else if (Array.isArray(payload) && ['products', 'purchases', 'categories'].includes(type)) {
                 const storeName = type;
                 const tx = dbInstance.transaction(storeName, 'readwrite');
                 const store = tx.objectStore(storeName);
                 store.clear(); 
                 payload.forEach(item => {
                     store.put(item); 
                 });
                 await new Promise((res, rej) => { tx.oncomplete = res; tx.onerror = rej; });
                 logToSyncConsole(`Successfully synced ${payload.length} items for ${type}.`);
                 
                 notifBody = `Received and synced ${payload.length} ${type}.`;
                 showAlert(notifBody, 'success');

                 if (['products', 'categories'].includes(type) && ['products', 'orders', 'categories'].includes(state.currentSection)) {
                    await populateFilterDropdowns();
                    await render();
                 }
                 if (type === 'purchases' && ['purchases'].includes(state.currentSection)) await render();
            }

            triggerNotification(notifTitle, {
                body: notifBody,
                icon: './favicon.ico'
            });

        } catch (error) {
            console.error(`Error processing received ${type} data:`, error);
            logToSyncConsole(`Error processing received ${type} data.`);
        }
    }

    // ---------------------------------------------------------------------------
    //  10. Application Initialization
    // ---------------------------------------------------------------------------
    
    async function init() {
        try {
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Notification permission granted.');
                    }
                });
            }

            await openDatabase();
            await initSampleData();
            
            const allOrders = await db.getAll('orders', 'status', IDBKeyRange.only('active'));
            allOrders.forEach(order => {
                state.activeOrders[order.tableOrParcelId] = order;
            });

            const [theme, tax, language] = await Promise.all([
                db.get('settings', 'theme'), db.get('settings', 'taxRate'), db.get('settings', 'language'),
            ]);

            state.currentLanguage = language ? language.value : 'mm';
            await applyTheme();
            await setLanguage(state.currentLanguage);
            state.taxRate = tax ? tax.value : 0;
            
            setupEventListeners();
            await render();
            console.log('Restaurant POS System Lite Initialized');
        } catch (error) {
            console.error('Initialization error:', error);
            showAlert('Failed to initialize application. Please refresh the page.', 'danger');
        }
    }

    checkActivation(); // Start activation check first
});
</script>
<script>
// ဘရောက်ဇာက Service Worker ကို အသုံးပြုနိုင်စွမ်းရှိမရှိ စစ်ဆေးခြင်း
  if ('serviceWorker' in navigator) {
    // စာမျက်နှာ အားလုံး load လုပ်ပြီးမှ Service Worker ကို register လုပ်ခြင်း
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(registration => {
          // အောင်မြင်စွာ register လုပ်နိုင်ကြောင်း console တွင် မှတ်တမ်းတင်ခြင်း
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch(error => {
          // register လုပ်ရာတွင် အမှားအယွင်းရှိပါက console တွင် မှတ်တမ်းတင်ခြင်း
          console.log('ServiceWorker registration failed: ', error);
        });
    });
  }</script>
</body></html>
